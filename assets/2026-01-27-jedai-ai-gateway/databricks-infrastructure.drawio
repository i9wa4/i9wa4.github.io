<mxfile host="app.diagrams.net" agent="Claude" version="24.7.17">
  <diagram name="Page-1" id="db-infra">
    <mxGraphModel defaultFontFamily="Noto Sans JP" dx="1434" dy="836" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="1920" pageHeight="1080" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Databricks内で完結する構成（外部サービス不要）" style="text;html=1;fontSize=24;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#333333;align=center;" vertex="1" parent="1">
          <mxGeometry x="200" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- Databricks Frame -->
        <mxCell id="db-frame" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FAFAFA;strokeColor=#FF6D00;strokeWidth=4;dashed=0;" vertex="1" parent="1">
          <mxGeometry x="60" y="80" width="880" height="380" as="geometry" />
        </mxCell>
        <mxCell id="db-label" value="Databricks" style="text;html=1;fontSize=20;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#FF6D00;" vertex="1" parent="1">
          <mxGeometry x="80" y="90" width="150" height="30" as="geometry" />
        </mxCell>

        <!-- AI Gateway -->
        <mxCell id="gw-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="140" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="gw-title" value="Mosaic AI Gateway" style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#1565C0;align=center;" vertex="1" parent="1">
          <mxGeometry x="100" y="160" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="gw-desc" value="統一エンドポイント&lt;br&gt;Pay-per-token" style="text;html=1;fontSize=14;fontFamily=Noto Sans JP;fontColor=#1565C0;align=center;" vertex="1" parent="1">
          <mxGeometry x="100" y="190" width="200" height="40" as="geometry" />
        </mxCell>

        <!-- Arrow GW to Usage -->
        <mxCell id="arr-gw-usage" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#4CAF50;endArrow=classic;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="300" y="190" as="sourcePoint" />
            <mxPoint x="400" y="190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr-gw-usage-label" value="自動記録" style="text;html=1;fontSize=12;fontFamily=Noto Sans JP;fontColor=#4CAF50;" vertex="1" parent="1">
          <mxGeometry x="320" y="165" width="60" height="20" as="geometry" />
        </mxCell>

        <!-- endpoint_usage -->
        <mxCell id="usage-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="400" y="140" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="usage-title" value="endpoint_usage" style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#2E7D32;align=center;" vertex="1" parent="1">
          <mxGeometry x="400" y="160" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="usage-desc" value="system.serving&lt;br&gt;使用量テーブル" style="text;html=1;fontSize=14;fontFamily=Noto Sans JP;fontColor=#2E7D32;align=center;" vertex="1" parent="1">
          <mxGeometry x="400" y="190" width="200" height="40" as="geometry" />
        </mxCell>

        <!-- Arrow Usage to Alert -->
        <mxCell id="arr-usage-alert" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#FF9800;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="600" y="190" as="sourcePoint" />
            <mxPoint x="700" y="190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr-usage-alert-label" value="15分毎" style="text;html=1;fontSize=12;fontFamily=Noto Sans JP;fontColor=#FF9800;" vertex="1" parent="1">
          <mxGeometry x="620" y="165" width="50" height="20" as="geometry" />
        </mxCell>

        <!-- SQL Alert -->
        <mxCell id="alert-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FF9800;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="700" y="140" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="alert-title" value="SQL Alert" style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#E65100;align=center;" vertex="1" parent="1">
          <mxGeometry x="700" y="160" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="alert-desc" value="予算超過を検知&lt;br&gt;SQLクエリで監視" style="text;html=1;fontSize=14;fontFamily=Noto Sans JP;fontColor=#E65100;align=center;" vertex="1" parent="1">
          <mxGeometry x="700" y="190" width="200" height="40" as="geometry" />
        </mxCell>

        <!-- Arrow Alert to Job -->
        <mxCell id="arr-alert-job" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#F44336;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="800" y="240" as="sourcePoint" />
            <mxPoint x="800" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr-alert-job-label" value="トリガー" style="text;html=1;fontSize=12;fontFamily=Noto Sans JP;fontColor=#F44336;" vertex="1" parent="1">
          <mxGeometry x="810" y="250" width="60" height="20" as="geometry" />
        </mxCell>

        <!-- Job -->
        <mxCell id="job-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#F44336;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="700" y="280" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="job-title" value="Databricks Job" style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#C62828;align=center;" vertex="1" parent="1">
          <mxGeometry x="700" y="300" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="job-desc" value="Rate Limit設定&lt;br&gt;自動遮断処理" style="text;html=1;fontSize=14;fontFamily=Noto Sans JP;fontColor=#C62828;align=center;" vertex="1" parent="1">
          <mxGeometry x="700" y="330" width="200" height="40" as="geometry" />
        </mxCell>

        <!-- Arrow Job to Token -->
        <mxCell id="arr-job-token" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#F44336;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="700" y="330" as="sourcePoint" />
            <mxPoint x="300" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr-job-token-label" value="Rate Limit設定" style="text;html=1;fontSize=12;fontFamily=Noto Sans JP;fontColor=#F44336;" vertex="1" parent="1">
          <mxGeometry x="460" y="305" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- Service Principal -->
        <mxCell id="sp-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8EAF6;strokeColor=#3F51B5;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="280" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sp-title" value="Service Principal" style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#283593;align=center;" vertex="1" parent="1">
          <mxGeometry x="100" y="300" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="sp-desc" value="インフラ管理&lt;br&gt;Rate Limit制御" style="text;html=1;fontSize=14;fontFamily=Noto Sans JP;fontColor=#283593;align=center;" vertex="1" parent="1">
          <mxGeometry x="100" y="330" width="200" height="40" as="geometry" />
        </mxCell>

        <!-- Arrow SP to GW -->
        <mxCell id="arr-sp-gw" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#3F51B5;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="200" y="280" as="sourcePoint" />
            <mxPoint x="200" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Budget Table -->
        <mxCell id="budget-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#9C27B0;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="400" y="280" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="budget-title" value="予算テーブル" style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#7B1FA2;align=center;" vertex="1" parent="1">
          <mxGeometry x="400" y="300" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="budget-desc" value="ユーザー別上限設定&lt;br&gt;Delta Table" style="text;html=1;fontSize=14;fontFamily=Noto Sans JP;fontColor=#7B1FA2;align=center;" vertex="1" parent="1">
          <mxGeometry x="400" y="330" width="200" height="40" as="geometry" />
        </mxCell>

        <!-- Arrow Usage to Budget -->
        <mxCell id="arr-usage-budget" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9C27B0;dashed=1;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="500" y="240" as="sourcePoint" />
            <mxPoint x="500" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Point box -->
        <mxCell id="point-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#FFC107;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="60" y="480" width="880" height="50" as="geometry" />
        </mxCell>
        <mxCell id="point-text" value="外部DB、外部Proxy、外部認証サービス一切不要。Databricksだけで完結。" style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;fontStyle=1;fontColor=#F57F17;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="60" y="490" width="880" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
