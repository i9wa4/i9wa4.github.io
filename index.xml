<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>uma-chan&#39;s page</title>
<link>https://i9wa4.github.io/</link>
<atom:link href="https://i9wa4.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description>All of my thoughts.
</description>
<image>
<url>https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg</url>
<title>uma-chan&#39;s page</title>
<link>https://i9wa4.github.io/</link>
</image>
<generator>quarto-1.7.32</generator>
<lastBuildDate>Sun, 28 Sep 2025 12:38:33 GMT</lastBuildDate>
<item>
  <title>BigQuery で dbt incremental モデルのパフォーマンス改善をしてみた</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-09-28-bigquery-dbt-incremental-intro.html</link>
  <description><![CDATA[ 





<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>ログ同士を突き合わせる dbt モデルの dbt run 実行時間が1時間を超えていたため、BigQuery の特性を活かしつつ実行時間を40分短縮した流れを紹介します。対象はイミューターなログを扱うモデルで、過去データの更新を考慮しない前提を置ける構造でした。</p>
</section>
<section id="当初の課題" class="level2">
<h2 class="anchored" data-anchor-id="当初の課題">2. 当初の課題</h2>
<ul>
<li>incremental_strategy が merge で、ターゲットテーブル全体を走査していた</li>
<li>unique_key が15列と多く、結合条件が複雑であった</li>
<li>参照元テーブルが期間条件なしで FULL OUTER JOIN され、中間結果が肥大化していた</li>
</ul>
</section>
<section id="実施した改善策" class="level2">
<h2 class="anchored" data-anchor-id="実施した改善策">3. 実施した改善策</h2>
<section id="incremental_strategy-の切り替え" class="level3">
<h3 class="anchored" data-anchor-id="incremental_strategy-の切り替え">3.1. incremental_strategy の切り替え</h3>
<ul>
<li>merge から insert_overwrite へ変更し、対象パーティションのみを差し替えた</li>
</ul>
</section>
<section id="パーティションプルーニングの徹底" class="level3">
<h3 class="anchored" data-anchor-id="パーティションプルーニングの徹底">3.2. パーティションプルーニングの徹底</h3>
<ul>
<li>vars で渡した日付範囲を JOIN 前のフィルタで適用し、読み取り対象を日次で限定した</li>
<li>パーティション指定を日単位で明示化し、BigQuery のスキャン範囲を事前に制限した</li>
</ul>
</section>
<section id="重複除去ロジックの簡素化" class="level3">
<h3 class="anchored" data-anchor-id="重複除去ロジックの簡素化">3.3. 重複除去ロジックの簡素化</h3>
<ul>
<li>15列のunique_key指定を ROW_NUMBER() による決定的な重複除去に変更した</li>
<li>複雑なMERGE処理からシンプルな重複除去ロジックへ簡素化した</li>
</ul>
</section>
</section>
<section id="効果と検証" class="level2">
<h2 class="anchored" data-anchor-id="効果と検証">4. 効果と検証</h2>
<ul>
<li>dbt run 実行時間は1時間超えから40分短縮できた</li>
<li>同期間の surrogate key 単位で件数と代表値を比較し整合性を確認できた</li>
<li>修正前後で更新内容に差異がないことを確認できた (ログデータの特性上そうなる)</li>
</ul>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">5. おわりに</h2>
<p>BigQuery の挙動と dbt の incremental モデルへの習熟度がまだまだなので引き続き学びを深めます。</p>


</section>

 ]]></description>
  <category>tech</category>
  <category>tech-data</category>
  <category>tech-dbt</category>
  <guid>https://i9wa4.github.io/blog/2025-09-28-bigquery-dbt-incremental-intro.html</guid>
  <pubDate>Sun, 28 Sep 2025 12:38:33 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Codex CLI の設定ファイルを dotfiles で管理する</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-09-14-codex-cli-config-management.html</link>
  <description><![CDATA[ 





<p>Codex CLI を使い始めたのですが dotfiles 使いにとっては辛い部分があり距離を置いてしまっていました。</p>
<p>今回力技で設定ファイルを dotfiles で管理する方法を思いついたので紹介します。</p>
<section id="codex-cli-の設定ファイルについて" class="level2">
<h2 class="anchored" data-anchor-id="codex-cli-の設定ファイルについて">1. Codex CLI の設定ファイルについて</h2>
<p>Codex CLI の設定ファイルは <code>~/.config/codex/config.toml</code> です。</p>
<p>内容は例えば以下のような感じです。</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[projects."</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">/Users/uma/ghq/github.com/i9wa4/dotfiles"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">trust_level</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trusted"</span></span></code></pre></div>
</section>
<section id="問題点" class="level2">
<h2 class="anchored" data-anchor-id="問題点">2. 問題点</h2>
<p><code>config.toml</code> にはフルパスが書かれるため複数のマシンで設定を管理するのが面倒です。</p>
<p>かつどのプロジェクトを信頼するかの設定もマシンごとに異なることが多いので <code>config.toml</code> をそのまま dotfiles で管理するのはイマイチと言えます。</p>
</section>
<section id="解決策" class="level2">
<h2 class="anchored" data-anchor-id="解決策">3. 解決策</h2>
<p>共通設定だけ dotfiles の管理対象とし、プロジェクト別の設定はスクリプトで生成してしまうというものです。</p>
<p>これで困ることはほとんどないでしょう！</p>
<section id="config.toml-の生成スクリプト" class="level3">
<h3 class="anchored" data-anchor-id="config.toml-の生成スクリプト">3.1. config.toml の生成スクリプト</h3>
<p>共通設定を <code>~/.config/codex/config.common.toml</code> に書いておき、プロジェクトごとの設定を自動生成して <code>config.toml</code> を生成させます。</p>
<p>※リポジトリを ghq で管理していることを前提としています。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>~/.config/codex/generate_config.sh</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="~/.config/codex/generate_config.sh" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/usr/bin/env bash</span></span>
<span id="cb2-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-euo</span> pipefail</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">GHQ_BASE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${HOME}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>/ghq/github.com</span>
<span id="cb2-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">COMMON</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./config.common.toml"</span></span>
<span id="cb2-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">OUTPUT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./config.toml"</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dirname</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$0</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Copy common settings</span></span>
<span id="cb2-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cp</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${COMMON}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${OUTPUT}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add project-specific settings</span></span>
<span id="cb2-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">find</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${GHQ_BASE}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-maxdepth</span> 3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-type</span> d <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-name</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".git"</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/dev/null <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb2-15">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s|\.git$||'</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb2-16">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb2-17">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">read</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span></span>
<span id="cb2-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[[</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-z</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${repo}</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]]</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span></span>
<span id="cb2-19">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[projects.</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${repo}</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb2-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">trust_level = </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">trusted</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-22">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${OUTPUT}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-23"></span>
<span id="cb2-24"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generated: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${OUTPUT}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</div>
</section>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">4. おわりに</h2>
<p>dotfiles で管理しづらいから Codex CLI と距離を置いていたみなさん、これで今日から使えるようになりましたよ！</p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech-ai</category>
  <guid>https://i9wa4.github.io/blog/2025-09-14-codex-cli-config-management.html</guid>
  <pubDate>Sun, 14 Sep 2025 12:55:32 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>2025年のアウトプットまとめ with LAPRAS</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-09-02-activity.html</link>
  <description><![CDATA[ 





<p>2025年のアウトプットと参加イベントをふりかえると</p>
<p>アウトプットしたものや参加したイベントなどをまとめてみました。</p>
<section id="connpass" class="level2">
<h2 class="anchored" data-anchor-id="connpass">1. connpass</h2>
<ul>
<li>2025/09/29
<ul>
<li><a href="https://finatext.connpass.com/event/365995/">DataOps Night #8 ～スケーラブルでAI-Readyなデータ基盤の最前線～</a></li>
</ul></li>
<li>2025/07/29
<ul>
<li><a href="https://datayokocho.connpass.com/event/358114/">エンタメ業界のデータエンジニアリング最前線＃2 ～SEGA、DeNA</a></li>
</ul></li>
<li>2025/07/28
<ul>
<li><a href="https://findy.connpass.com/event/359455/">t-wadaさんに聞く！SQLアンチパターン第2版 - 全27章まとめて紹介！</a></li>
</ul></li>
<li>2025/07/18
<ul>
<li><a href="https://forkwell.connpass.com/event/357942/">祝30回！過去登壇者と振り返るデータエンジニアの技術とキャリアのこれまでとこれから</a></li>
</ul></li>
<li>2025/07/17
<ul>
<li><a href="https://findy.connpass.com/event/359987/">Claude Code Meetup</a></li>
</ul></li>
<li>2025/07/13
<ul>
<li><a href="https://supporterz-seminar.connpass.com/event/355775/">【！現地参加枠あり！】CoLab Conf（コラコン）【U35限定テックカンファレンス】</a></li>
</ul></li>
<li>2025/07/08
<ul>
<li><a href="https://aid.connpass.com/event/360017/">Claude Code Meetup Japan #1（Claude Code祭り！）</a></li>
</ul></li>
<li>2025/07/04
<ul>
<li><a href="https://pixiv.connpass.com/event/358285/">Data Modeling Night -「今」だからできる理論の実践事例 -</a></li>
</ul></li>
<li>2025/06/30
<ul>
<li><a href="https://cartaholdings.connpass.com/event/360380/">Claude Code Deep Dive</a></li>
</ul></li>
<li>2025/06/25
<ul>
<li><a href="https://scalar.connpass.com/event/356595/">Database Engineering Meetup #7: データエンジニアリング</a></li>
</ul></li>
<li>2025/06/24
<ul>
<li><a href="https://datayokocho.connpass.com/event/353850/">エンタメ業界のデータエンジニアリング最前線＃１　～GENDA、バンダイナムコセブンズ</a></li>
</ul></li>
<li>2025/06/20
<ul>
<li><a href="https://flexy.connpass.com/event/357244/">【SREキャリア最前線】AIと共に進化する！SREの新たな役割とキャリア設計</a></li>
</ul></li>
<li>2025/06/17
<ul>
<li><a href="https://findy.connpass.com/event/357707/">MCP導入における脅威モデリングのすゝめ</a></li>
</ul></li>
<li>2025/06/12
<ul>
<li><a href="https://classmethod.connpass.com/event/356615/">エンジニアのためのMCP勉強会 #2</a></li>
</ul></li>
<li>2025/06/06
<ul>
<li><a href="https://aiau.connpass.com/event/353531/">Cursor Meetup Tokyo</a></li>
</ul></li>
<li>2025/06/03
<ul>
<li><a href="https://forkwell.connpass.com/event/349495/">ITエンジニアの転職学 – “20代で年収800万円最速RTA”と“その罠”</a></li>
</ul></li>
<li>2025/06/02
<ul>
<li><a href="https://mlops.connpass.com/event/352150/">MCP Ops LT大会！！！</a></li>
</ul></li>
<li>2025/05/28
<ul>
<li><a href="https://explaza.connpass.com/event/354178/">Cursorで創作小説を書こう！の会【女オタ生成AI部/株式会社エクスプラザ 共催】</a></li>
</ul></li>
<li>2025/05/27
<ul>
<li><a href="https://finatext.connpass.com/event/350823/">DataOps Night #7</a></li>
</ul></li>
<li>2025/05/16
<ul>
<li><a href="https://forkwell.connpass.com/event/354289/">転職したらMCPサーバーだった件</a></li>
</ul></li>
<li>2025/05/14
<ul>
<li><a href="https://jedai.connpass.com/event/349260/">JEDAI Meetup! Databricks Apps特集 (ハイブリッド開催)</a></li>
</ul></li>
<li>2025/05/14
<ul>
<li><a href="https://findy.connpass.com/event/349580/">【技術選定を突き詰める】Online Conferenc​​e 2025</a></li>
</ul></li>
<li>2025/05/13
<ul>
<li><a href="https://forkwell.connpass.com/event/350515/">Cursor導入でログラス社の現場はどう変わったか - Forkwell AI Study #1</a></li>
</ul></li>
<li>2025/05/12
<ul>
<li><a href="https://itgtechacademy.connpass.com/event/350401/">「データマネジメント」その先へ〜進化するデータと組織戦略～</a></li>
</ul></li>
<li>2025/04/25
<ul>
<li><a href="https://findy.connpass.com/event/351644/">MCPでLLMはどう進化する？ 〜からあげさんに学ぶ、AI開発の最前線〜</a></li>
</ul></li>
<li>2025/04/25
<ul>
<li><a href="https://jedai.connpass.com/event/349457/">JEDAI in Osaka 2025 春 (オンサイト+オンライン)</a></li>
</ul></li>
<li>2025/04/24
<ul>
<li><a href="https://forkwell.connpass.com/event/351066/">Data Engineering Study #29 今だから学びたいDatabricks徹底活用術</a></li>
</ul></li>
<li>2025/04/10
<ul>
<li><a href="https://supporterz-seminar.connpass.com/event/347922/">データエンジニアの未来【サポーターズCoLab】</a></li>
</ul></li>
<li>2025/03/25
<ul>
<li><a href="https://findy-tools.connpass.com/event/347398/">ABEMAの事例とともに学ぶ！セマンティックレイヤーで変わるデータエンジニアリングの世界</a></li>
</ul></li>
<li>2025/03/21
<ul>
<li><a href="https://forkwell.connpass.com/event/346470/">ITエンジニアの転職学 ー 40歳へのカウントダウンとの向き合い方</a></li>
</ul></li>
<li>2025/02/27
<ul>
<li><a href="https://forkwell.connpass.com/event/339761/">Data Engineering Study #28 データ基盤のCI/CD</a></li>
</ul></li>
<li>2025/02/04
<ul>
<li><a href="https://datayokocho.connpass.com/event/343004/">金融業界のデータマネジメント最前線 #6</a></li>
</ul></li>
<li>2025/01/30
<ul>
<li><a href="https://datatech-jp.connpass.com/event/335207/">みんなの考えた最強のデータアーキテクチャ〜2025もやってきましょうSP！</a></li>
</ul></li>
<li>2025/01/27
<ul>
<li><a href="https://redbrick.connpass.com/event/341139/">レイクハウスって結局何なのっていいました？じゃあ真のレイクハウスをみせてやりますよ！</a></li>
</ul></li>
<li>2025/01/24
<ul>
<li><a href="https://findy-tools.connpass.com/event/341178/">JR西日本・ファーストリテイリング・ZOZOが語るビジネス要件を踏まえたデータ基盤の構築</a></li>
</ul></li>
<li>2025/01/20
<ul>
<li><a href="https://datatech-jp.connpass.com/event/337374/">datatech-jp Casual Talks #6</a></li>
</ul></li>
</ul>
</section>
<section id="blog等" class="level2">
<h2 class="anchored" data-anchor-id="blog等">2. Blog等</h2>
<ul>
<li>2025/08/23
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-08-23-diary.html">2025-08-23 日誌</a></li>
</ul></li>
<li>2025/07/28
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-07-28-article3-databricks-connect.html">Databricks Connect 実践編 - ローカルから Databricks コンピュートを利用</a></li>
</ul></li>
<li>2025/07/28
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-07-28-article2-python-env.html">Python 開発環境最適化編 - uv + pre-commit + GitHub Actions</a></li>
</ul></li>
<li>2025/07/28
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-07-28-article1-devcontainer.html">Claude Code 対応 Dev Container 環境構築編 - VS Code でもそれ以外でも</a></li>
</ul></li>
<li>2025/07/14
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-07-14-optimize-your-teminal-for-claude-code.html">個人的ターミナル最適化 for Claude Code</a></li>
</ul></li>
<li>2025/07/14
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-07-14-my-first-vim-contribution.html">Vimへの初コントリビューションの経緯と学び</a></li>
</ul></li>
<li>2025/06/20
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-06-20-vim-plugin-for-tmux-claude-code.html">tmux で Vim から Claude Code にテキストを送信するプラグインを作った</a></li>
</ul></li>
<li>2025/06/15
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-06-15-dbt-bigquery-auth.html">ローカル dbt で BigQuery への認証を行う</a></li>
</ul></li>
<li>2025/06/10
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-06-10-install-global-python-with-uv.html">uv で Python のグローバルインストールを行う</a></li>
</ul></li>
<li>2025/06/08
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-06-08-create-uv-venv-with-poetry-pyproject-toml.html">Poetry の pyproject.toml を使って uv で .venv を作成する</a></li>
</ul></li>
<li>2025/06/04
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-06-04-use-cmdbang-to-disable-lsp-formatting-on-save.html">Vim/Neovim の保存時の LSP フォーマットを :w! のときに無効化する方法</a></li>
</ul></li>
<li>2025/05/21
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-05-21-databricks-dashboard-github-operation.html">Databricks AI/BI ダッシュボードの Git 連携の運用方法</a></li>
</ul></li>
<li>2025/05/12
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-05-12-hands-on-lambda-ecr.html">AWS Lambda でコンテナイメージを実行する with Terraform &amp; GitHub Actions</a></li>
</ul></li>
<li>2025/05/10
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-05-10-bash-zsh-edit-and-execute-command.html">Bash/Zsh でコマンドをエディタで編集する</a></li>
</ul></li>
<li>2025/05/06
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-05-06-editorconfig-vim.html">今更ながら Vim に EditorConfig を導入しました</a></li>
</ul></li>
<li>2025/05/06
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-05-06-python-venv.html">Python venv インストール・更新スクリプトの供養</a></li>
</ul></li>
<li>2025/05/06
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-05-06-quarto-slides.html">Markdown ライクな Quarto でスライドを作成して GitHub Actions で HTML 出力する</a></li>
</ul></li>
<li>2025/05/04
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-05-04-tmux-zsh-git-status.html">tmux と Zsh に Git リポジトリのステータスを表示する</a></li>
</ul></li>
<li>2025/04/29
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-04-29-mcp-databricks-server-service-principal.html">Databricks MCP Server を Service Principal 認証対応させた</a></li>
</ul></li>
<li>2025/04/20
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-04-20-lefthook.html">lefthook 設定の供養</a></li>
</ul></li>
<li>2025/04/11
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-04-11-mcp-hands-on.html">MCP に入門した</a></li>
</ul></li>
<li>2025/04/10
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-04-10-paid-for-gemini-api.html">Gemini API に課金した</a></li>
</ul></li>
<li>2025/04/10
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-04-10-paid-for-gemini.html">Gemini に課金した</a></li>
</ul></li>
<li>2025/04/07
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-04-07-bookmarks.html">個人的ブックマーク</a></li>
</ul></li>
<li>2025/04/02
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-04-02-looking-back-on-2024.html">2024年度を振り返る</a></li>
</ul></li>
<li>2025/04/01
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-04-01-try-aider.html">Aider を使ってみる</a></li>
</ul></li>
<li>2025/02/21
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-02-21-plain-sql.html">見やすい SQL を書くための Tips</a></li>
</ul></li>
<li>2025/02/20
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-02-20-vim-plugin-idea.html">最近の Vim プラグイン開発のアイデア</a></li>
</ul></li>
<li>2025/01/31
<ul>
<li><a href="https://i9wa4.github.io/blog/2025-01-31-get-instagram-api-access-token.html">Instagram API のアクセストークンを取得する</a></li>
</ul></li>
</ul>
</section>
<section id="zenn" class="level2">
<h2 class="anchored" data-anchor-id="zenn">3. Zenn</h2>
<ul>
<li>2025/08/06
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-08-06-databricks-connect-practice">Databricks Connect 実践編 - ローカルから Databricks コンピュートを利用</a></li>
</ul></li>
<li>2025/08/06
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-08-06-python-env-optimization">Python 開発環境最適化編 - uv + pre-commit + GitHub Actions</a></li>
</ul></li>
<li>2025/08/06
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-08-06-devcontainer-claude-code">Claude Code 対応 Dev Container 環境構築編 - VS Code でもそれ以外でも</a></li>
</ul></li>
<li>2025/07/16
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-07-16-optimize-your-terminal-for-claude-code">個人的ターミナル最適化 for Claude Code</a></li>
</ul></li>
<li>2025/05/06
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-05-06-quarto-slides">Markdown ライクな Quarto でスライドを作成して GitHub Actions で HTML 出力する</a></li>
</ul></li>
<li>2025/05/04
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-05-04-tmux-zsh-git-status">tmux と Zsh に Git リポジトリのステータスを表示する</a></li>
</ul></li>
<li>2025/04/29
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-04-29-mcp-databricks-server-service-principal">Databricks MCP Server を Service Principal 認証対応させた</a></li>
</ul></li>
<li>2025/04/16
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-04-16-issue-with-python-libraries">Python でありがちな本体バージョンとライブラリバージョンの不整合の例</a></li>
</ul></li>
<li>2025/04/05
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-04-05-weekly-report-prompt-for-devin">Devin 週報作成用プロンプト</a></li>
</ul></li>
<li>2025/04/05
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-04-05-weekly-report-by-devin">Devin に週報を書いてもらった</a></li>
</ul></li>
<li>2025/03/28
<ul>
<li><a href="https://zenn.dev/i9wa4/articles/2025-03-28-display-notion-relation-property">Notion データベースでリレーション元のプロパティを表示する (2025年3月28日時点)</a></li>
</ul></li>
</ul>
</section>
<section id="pr作成" class="level2">
<h2 class="anchored" data-anchor-id="pr作成">4. PR作成</h2>
<ul>
<li>2025/08/06
<ul>
<li><a href="https://github.com/i9wa4/zenn-i9wa4/pulls?q=is:pr+author:i9wa4">i9wa4/zenn-i9wa4</a></li>
</ul></li>
<li>2025/07/28
<ul>
<li><a href="https://github.com/i9wa4/i9wa4.github.io/pulls?q=is:pr+author:i9wa4">i9wa4/i9wa4.github.io</a></li>
</ul></li>
<li>2025/07/16
<ul>
<li><a href="https://github.com/i9wa4/zenn-i9wa4/pulls?q=is:pr+author:i9wa4">i9wa4/zenn-i9wa4</a></li>
</ul></li>
<li>2025/07/14
<ul>
<li><a href="https://github.com/i9wa4/vim-tmux-send-to-ai-cli/pulls?q=is:pr+author:i9wa4">i9wa4/vim-tmux-send-to-ai-cli</a></li>
</ul></li>
<li>2025/07/14
<ul>
<li><a href="https://github.com/i9wa4/vim-markdown-number-header/pulls?q=is:pr+author:i9wa4">i9wa4/vim-markdown-number-header</a></li>
</ul></li>
<li>2025/07/14
<ul>
<li><a href="https://github.com/i9wa4/i9wa4.github.io/pulls?q=is:pr+author:i9wa4">i9wa4/i9wa4.github.io</a></li>
</ul></li>
<li>2025/07/14
<ul>
<li><a href="https://github.com/i9wa4/dotfiles/pulls?q=is:pr+author:i9wa4">i9wa4/dotfiles</a></li>
</ul></li>
<li>2025/07/13
<ul>
<li><a href="https://github.com/i9wa4/i9wa4.github.io/pulls?q=is:pr+author:i9wa4">i9wa4/i9wa4.github.io</a></li>
</ul></li>
<li>2025/06/26
<ul>
<li><a href="https://github.com/i9wa4/vim-tmux-send-to-ai-cli/pulls?q=is:pr+author:i9wa4">i9wa4/vim-tmux-send-to-ai-cli</a></li>
</ul></li>
<li>2025/06/25
<ul>
<li><a href="https://github.com/i9wa4/vim-tmux-send-to-ai-cli/pulls?q=is:pr+author:i9wa4">i9wa4/vim-tmux-send-to-ai-cli</a></li>
</ul></li>
<li>2025/06/19
<ul>
<li><a href="https://github.com/i9wa4/mcp-databricks-server/pulls?q=is:pr+author:i9wa4">i9wa4/mcp-databricks-server</a></li>
</ul></li>
<li>2025/05/19
<ul>
<li><a href="https://github.com/i9wa4/terraform-mono-repo/pulls?q=is:pr+author:i9wa4">i9wa4/terraform-mono-repo</a></li>
</ul></li>
<li>2025/05/18
<ul>
<li><a href="https://github.com/i9wa4/terraform-mono-repo/pulls?q=is:pr+author:i9wa4">i9wa4/terraform-mono-repo</a></li>
</ul></li>
<li>2025/05/10
<ul>
<li><a href="https://github.com/i9wa4/i9wa4.github.io/pulls?q=is:pr+author:i9wa4">i9wa4/i9wa4.github.io</a></li>
</ul></li>
<li>2025/05/06
<ul>
<li><a href="https://github.com/i9wa4/zenn-i9wa4/pulls?q=is:pr+author:i9wa4">i9wa4/zenn-i9wa4</a></li>
</ul></li>
<li>2025/05/06
<ul>
<li><a href="https://github.com/i9wa4/vim-markdown-number-header/pulls?q=is:pr+author:i9wa4">i9wa4/vim-markdown-number-header</a></li>
</ul></li>
<li>2025/05/04
<ul>
<li><a href="https://github.com/i9wa4/zenn-i9wa4/pulls?q=is:pr+author:i9wa4">i9wa4/zenn-i9wa4</a></li>
</ul></li>
<li>2025/04/29
<ul>
<li><a href="https://github.com/i9wa4/zenn-i9wa4/pulls?q=is:pr+author:i9wa4">i9wa4/zenn-i9wa4</a></li>
</ul></li>
<li>2025/04/29
<ul>
<li><a href="https://github.com/i9wa4/mcp-databricks-server/pulls?q=is:pr+author:i9wa4">i9wa4/mcp-databricks-server</a></li>
</ul></li>
<li>2025/04/16
<ul>
<li><a href="https://github.com/i9wa4/zenn-i9wa4/pulls?q=is:pr+author:i9wa4">i9wa4/zenn-i9wa4</a></li>
</ul></li>
<li>2025/04/08
<ul>
<li><a href="https://github.com/i9wa4/i9wa4.github.io/pulls?q=is:pr+author:i9wa4">i9wa4/i9wa4.github.io</a></li>
</ul></li>
<li>2025/04/05
<ul>
<li><a href="https://github.com/i9wa4/zenn-i9wa4/pulls?q=is:pr+author:i9wa4">i9wa4/zenn-i9wa4</a></li>
</ul></li>
<li>2025/04/02
<ul>
<li><a href="https://github.com/i9wa4/i9wa4.github.io/pulls?q=is:pr+author:i9wa4">i9wa4/i9wa4.github.io</a></li>
</ul></li>
<li>2025/04/01
<ul>
<li><a href="https://github.com/i9wa4/vim-dbt-jump2def/pulls?q=is:pr+author:i9wa4">i9wa4/vim-dbt-jump2def</a></li>
</ul></li>
<li>2025/03/31
<ul>
<li><a href="https://github.com/i9wa4/vim-dbt-jump2def/pulls?q=is:pr+author:i9wa4">i9wa4/vim-dbt-jump2def</a></li>
</ul></li>
<li>2025/03/28
<ul>
<li><a href="https://github.com/i9wa4/zenn-i9wa4/pulls?q=is:pr+author:i9wa4">i9wa4/zenn-i9wa4</a></li>
</ul></li>
<li>2025/03/15
<ul>
<li><a href="https://github.com/i9wa4/vim-markdown-number-header/pulls?q=is:pr+author:i9wa4">i9wa4/vim-markdown-number-header</a></li>
</ul></li>
<li>2025/03/15
<ul>
<li><a href="https://github.com/i9wa4/vim-dbt-jump2def/pulls?q=is:pr+author:i9wa4">i9wa4/vim-dbt-jump2def</a></li>
</ul></li>
</ul>
</section>
<section id="リポジトリ作成" class="level2">
<h2 class="anchored" data-anchor-id="リポジトリ作成">5. リポジトリ作成</h2>
<ul>
<li>2025/06/20
<ul>
<li><a href="https://github.com/i9wa4/vim-tmux-send-to-ai-cli">i9wa4/vim-tmux-send-to-ai-cli</a></li>
</ul></li>
<li>2025/05/03
<ul>
<li><a href="https://github.com/i9wa4/quarto-slides">i9wa4/quarto-slides</a></li>
</ul></li>
<li>2025/04/29
<ul>
<li><a href="https://github.com/i9wa4/mcp-databricks-server">i9wa4/mcp-databricks-server</a></li>
</ul></li>
<li>2025/04/10
<ul>
<li><a href="https://github.com/i9wa4/mcp-hands-on">i9wa4/mcp-hands-on</a></li>
</ul></li>
<li>2025/03/23
<ul>
<li><a href="https://github.com/i9wa4/terraform-mono-repo">i9wa4/terraform-mono-repo</a></li>
</ul></li>
<li>2025/02/06
<ul>
<li><a href="https://github.com/i9wa4/databricks-notebook-test">i9wa4/databricks-notebook-test</a></li>
</ul></li>
</ul>
<p><a href="https://lapras.com/" title="LAPRASポートフォリオはこちらから">LAPRASポートフォリオはこちらから</a></p>


</section>

 ]]></description>
  <category>blog</category>
  <category>diary</category>
  <guid>https://i9wa4.github.io/blog/2025-09-02-activity.html</guid>
  <pubDate>Tue, 02 Sep 2025 00:25:52 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>2025-08-23 日誌</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-08-23-diary.html</link>
  <description><![CDATA[ 





<p>毎日書いているような顔してますが初めての日誌です</p>
<section id="最近考えていること" class="level2">
<h2 class="anchored" data-anchor-id="最近考えていること">1. 最近考えていること</h2>
<p>色々と忙しくなり上手く回ってない感があり自己肯定感が下がっています。</p>
<p>が、下記のように最近新しく始めたことがちゃんと結構あって案外悪くないかも！</p>
</section>
<section id="最近新しく始めたこと" class="level2">
<h2 class="anchored" data-anchor-id="最近新しく始めたこと">2. 最近新しく始めたこと</h2>
<p>刺激を求めると色々好転する感覚があるので元々保守的でインドアですが頑張ってます。</p>
<p>ここ1-2ヶ月で新しく始めたこと</p>
<ul>
<li>馴染みのない技術要素 (CloudFormation, Datadog, AWS のネットワーク周り) に触れてみた</li>
<li>チームメンバーへのタスク切り出し・進捗管理を本格的にやっている</li>
<li>社内の飲みたい人集めて飲み会開いた</li>
<li>他部署の定例に勝手に毎週参加して居座る</li>
<li>半分仕事だけどデータ界隈の交流を増やしてみた</li>
<li>エンジニア友達 <a href="https://x.com/YKirin0418"><span class="citation" data-cites="YKirin0418">@YKirin0418</span></a> と初対面 &amp; サシ飲みした</li>
</ul>
</section>
<section id="副業ちゃんとやれてそう" class="level2">
<h2 class="anchored" data-anchor-id="副業ちゃんとやれてそう">3. 副業ちゃんとやれてそう</h2>
<p>6月から PIVOT の業務委託を始めていました。</p>
<p>これが副業デビューです。</p>
<p>最初はドメイン知識や開発環境面で苦戦していましたが徐々にシュッっと貢献する動きができるようになってきました！</p>
<p>自分のもつ経験やスキルを積極的に提供していければと思っています。</p>
<p>やっぱり自分の好きなプロダクトに関わるのは楽しいです。</p>
</section>
<section id="直近やってみたいこと" class="level2">
<h2 class="anchored" data-anchor-id="直近やってみたいこと">4. 直近やってみたいこと</h2>
<p>やる時間は無いだろうなと思いつつも書くだけ書いておきます。</p>
<p>Ubuntu に Docker Compose で Minecraft 統合版サーバーを立てているのですが、Java 版に切り替えて GeyserMC 対応をしたい！</p>


</section>

 ]]></description>
  <category>blog</category>
  <category>diary</category>
  <guid>https://i9wa4.github.io/blog/2025-08-23-diary.html</guid>
  <pubDate>Sat, 23 Aug 2025 14:59:20 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title></title>
  <dc:creator>馬渡 大樹</dc:creator>
  <link>https://i9wa4.github.io/slides/2025-08-08-midas-ai.html</link>
  <description><![CDATA[ undefined ]]></description>
  <category>slides</category>
  <category>genda</category>
  <guid>https://i9wa4.github.io/slides/2025-08-08-midas-ai.html</guid>
  <pubDate>Thu, 07 Aug 2025 15:00:00 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Databricks Connect 実践編 ― ローカルから Databricks コンピュートを利用</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-08-06-zenn-2025-08-06-databricks-connect-practice.html</link>
  <description><![CDATA[ 





<p>この記事は Zenn で公開されています。</p>
<p><a href="https://zenn.dev/genda_jp/articles/2025-08-06-databricks-connect-practice">Databricks Connect 実践編 ― ローカルから Databricks コンピュートを利用</a></p>



 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>zenn</category>
  <guid>https://i9wa4.github.io/blog/2025-08-06-zenn-2025-08-06-databricks-connect-practice.html</guid>
  <pubDate>Wed, 06 Aug 2025 10:02:01 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/zenn-logo.png" medium="image" type="image/png" height="29" width="144"/>
</item>
<item>
  <title>Python 開発環境最適化編 ― uv + pre-commit + GitHub Actions</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-08-06-zenn-2025-08-06-python-env-optimization.html</link>
  <description><![CDATA[ 





<p>この記事は Zenn で公開されています。</p>
<p><a href="https://zenn.dev/genda_jp/articles/2025-08-06-python-env-optimization">Python 開発環境最適化編 ― uv + pre-commit + GitHub Actions</a></p>



 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>zenn</category>
  <guid>https://i9wa4.github.io/blog/2025-08-06-zenn-2025-08-06-python-env-optimization.html</guid>
  <pubDate>Wed, 06 Aug 2025 10:01:01 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/zenn-logo.png" medium="image" type="image/png" height="29" width="144"/>
</item>
<item>
  <title>Claude Code 対応 Dev Container 環境構築編 ― VS Code でもそれ以外でも</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-08-06-zenn-2025-08-06-devcontainer-claude-code.html</link>
  <description><![CDATA[ 





<p>この記事は Zenn で公開されています。</p>
<p><a href="https://zenn.dev/genda_jp/articles/2025-08-06-devcontainer-claude-code">Claude Code 対応 Dev Container 環境構築編 ― VS Code でもそれ以外でも</a></p>



 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>zenn</category>
  <guid>https://i9wa4.github.io/blog/2025-08-06-zenn-2025-08-06-devcontainer-claude-code.html</guid>
  <pubDate>Wed, 06 Aug 2025 10:00:01 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/zenn-logo.png" medium="image" type="image/png" height="29" width="144"/>
</item>
<item>
  <title>Databricks Connect 実践編 ― ローカルから Databricks コンピュートを利用</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-07-28-article3-databricks-connect.html</link>
  <description><![CDATA[ 





<p>本記事は3部構成の3本目です。</p>
<ol type="1">
<li><a href="../blog/2025-07-28-article1-devcontainer.html">Claude Code 対応 Dev Container 環境構築編 - VS Code でもそれ以外でも</a></li>
<li><a href="../blog/2025-07-28-article2-python-env.html">Python 開発環境最適化編 - uv + pre-commit + GitHub Actions</a></li>
<li><a href="../blog/2025-07-28-article3-databricks-connect.html">Databricks Connect 実践編 - ローカルから Databricks コンピュートを利用</a></li>
</ol>
<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>前回までの環境に Databricks Connect を追加して、ローカル開発環境から Databricks の Spark セッションを利用できるようにします。</p>
<p>Databricks 上でもローカルでも同じコードが動作する汎用的なライブラリも紹介します。</p>
</section>
<section id="対象読者" class="level2">
<h2 class="anchored" data-anchor-id="対象読者">2. 対象読者</h2>
<ul>
<li>Databricks のコンピュートをローカルから利用したい方</li>
<li>Databricks 上での開発に Claude Code を利用したい方</li>
<li>Databricks 以外の DWH サービスを使っているが参考にしたい方</li>
</ul>
</section>
<section id="databricks-connect-とは" class="level2">
<h2 class="anchored" data-anchor-id="databricks-connect-とは">3. Databricks Connect とは</h2>
<p>Databricks Connect は、ローカル開発環境から Databricks クラスタに接続できるライブラリです。</p>
<p>これにより以下のメリットが得られます。</p>
<ul>
<li>VS Code や Claude Code などのローカル開発環境が利用できる</li>
<li>ローカルでの開発と Databricks 上での実行で同じコードが使える</li>
</ul>
</section>
<section id="環境設定" class="level2">
<h2 class="anchored" data-anchor-id="環境設定">4. 環境設定</h2>
<section id="pyproject.toml-への追加" class="level3">
<h3 class="anchored" data-anchor-id="pyproject.toml-への追加">4.1. pyproject.toml への追加</h3>
<p>前回の pyproject.toml に以下の依存関係を追加します。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>pyproject.toml</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="pyproject.toml" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb1-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"databricks-connect~=16.4.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ipykernel"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jupyterlab"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matplotlib"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numpy"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pandas"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python-dotenv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"requests"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seaborn"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.flake8]</span></span>
<span id="cb1-15"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">extend-ignore</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb1-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E203"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Whitespace before ':'</span></span>
<span id="cb1-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E701"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiple statements on one line (colon)</span></span>
<span id="cb1-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F821"</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># undefined name (Databricks-specific module)</span></span>
<span id="cb1-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</div>
</section>
<section id="dev-container設定の更新" class="level3">
<h3 class="anchored" data-anchor-id="dev-container設定の更新">4.2. Dev Container設定の更新</h3>
<p>devcontainer.json に以下の設定を追加します。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.devcontainer/devcontainer.json</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename=".devcontainer/devcontainer.json" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"runArgs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb2-3">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--cap-add=NET_ADMIN"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--cap-add=NET_RAW"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--network=host"</span></span>
<span id="cb2-6">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"mounts"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb2-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=${localEnv:HOME}/.databrickscfg,target=/home/node/.databrickscfg,type=bind,consistency=cached"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-9">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
</section>
<section id="環境変数設定" class="level3">
<h3 class="anchored" data-anchor-id="環境変数設定">4.3. 環境変数設定</h3>
<p><code>.env.example</code> ファイルを作成します。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.env.example</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename=".env.example" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Databricks設定</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .databrickscfgのプロファイル名（推奨）</span></span>
<span id="cb3-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">DATABRICKS_CONFIG_PROFILE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>DEFAULT</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># クラスター使用の場合（どちらか一方を設定）</span></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DATABRICKS_CLUSTER_ID=</span></span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Serverless Compute使用の場合</span></span>
<span id="cb3-10"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">DATABRICKS_SERVERLESS_COMPUTE_ID</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>auto</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># バージョンチェック無効化</span></span>
<span id="cb3-13"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">DATABRICKS_CONNECT_DISABLE_VERSION_CHECK</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true</span></code></pre></div>
</div>
</section>
</section>
<section id="spark-セッション管理ライブラリ" class="level2">
<h2 class="anchored" data-anchor-id="spark-セッション管理ライブラリ">5. Spark セッション管理ライブラリ</h2>
<p>Dev Container (ローカル) と Databricks の両方で同じように Spark セッションを作成するためのライブラリを用意しました。</p>
<section id="使用方法" class="level3">
<h3 class="anchored" data-anchor-id="使用方法">5.1. 使用方法</h3>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> databricks_spark <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> create_spark_session</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 新しいSparkセッションを作成</span></span>
<span id="cb4-4">spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_spark_session()</span>
<span id="cb4-5">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spark.sql(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SHOW CATALOGS"</span>)</span>
<span id="cb4-6">df.show()</span></code></pre></div>
</section>
<section id="ライブラリ実装" class="level3">
<h3 class="anchored" data-anchor-id="ライブラリ実装">5.2. ライブラリ実装</h3>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
5.2.1. <code>databricks_spark.py</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>databricks_spark.py</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="databricks_spark.py" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Databricks Spark セッション管理</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Databricksとローカル両対応の1ファイル完結型ライブラリ</span></span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">使用方法:</span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    from databricks_spark import create_spark_session</span></span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    # 新しいSparkセッションを作成</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    spark = create_spark_session()</span></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    df = spark.sql("SHOW CATALOGS")</span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    df.show()</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-13"></span>
<span id="cb5-14"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb5-15"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb5-16"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sys</span>
<span id="cb5-17"></span>
<span id="cb5-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ロガー設定</span></span>
<span id="cb5-19">_logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb5-20"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> _logger.handlers:</span>
<span id="cb5-21">    _logger.setLevel(logging.INFO)</span>
<span id="cb5-22">    formatter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.Formatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%(asctime)s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%(name)s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%(levelname)s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">] </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%(message)s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-23">    handler <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.StreamHandler(sys.stdout)</span>
<span id="cb5-24">    handler.setFormatter(formatter)</span>
<span id="cb5-25">    _logger.addHandler(handler)</span>
<span id="cb5-26"></span>
<span id="cb5-27"></span>
<span id="cb5-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> is_databricks_environment() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>:</span>
<span id="cb5-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Databricks環境で実行されているかを判定"""</span></span>
<span id="cb5-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> os.environ.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_RUNTIME_VERSION"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb5-31"></span>
<span id="cb5-32"></span>
<span id="cb5-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_environment_type() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb5-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""実行環境のタイプを取得"""</span></span>
<span id="cb5-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> is_databricks_environment():</span>
<span id="cb5-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"databricks"</span></span>
<span id="cb5-37">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb5-38">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"local"</span></span>
<span id="cb5-39"></span>
<span id="cb5-40"></span>
<span id="cb5-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_databricks_native_session():</span>
<span id="cb5-42">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Databricks上でのネイティブSparkセッション作成"""</span></span>
<span id="cb5-43">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb5-44">        <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pyspark.sql <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SparkSession</span>
<span id="cb5-45"></span>
<span id="cb5-46">        spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SparkSession.getActiveSession()</span>
<span id="cb5-47">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> spark <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb5-48">            spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SparkSession.builder.appName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DatabricksNotebook"</span>).getOrCreate()</span>
<span id="cb5-49"></span>
<span id="cb5-50">        _logger.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"✅ Databricks native Sparkセッション取得完了"</span>)</span>
<span id="cb5-51">        _logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"📊 Spark version: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>spark<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-52">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> spark</span>
<span id="cb5-53"></span>
<span id="cb5-54">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ImportError</span>:</span>
<span id="cb5-55">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ImportError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Databricks環境でPySparkが利用できません"</span>)</span>
<span id="cb5-56"></span>
<span id="cb5-57"></span>
<span id="cb5-58"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_local_connect_session():</span>
<span id="cb5-59">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""ローカルでのDatabricksConnect Sparkセッション作成"""</span></span>
<span id="cb5-60">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb5-61">        <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> databricks.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DatabricksSession</span>
<span id="cb5-62"></span>
<span id="cb5-63">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 環境変数のデフォルト値を設定</span></span>
<span id="cb5-64">        os.environ.setdefault(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_CONFIG_PROFILE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DEFAULT"</span>)</span>
<span id="cb5-65">        os.environ.setdefault(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_SERVERLESS_COMPUTE_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto"</span>)</span>
<span id="cb5-66">        os.environ.setdefault(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_CONNECT_DISABLE_VERSION_CHECK"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"true"</span>)</span>
<span id="cb5-67"></span>
<span id="cb5-68">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .env読み込み（オプション）</span></span>
<span id="cb5-69">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb5-70">            <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> find_dotenv, load_dotenv</span>
<span id="cb5-71"></span>
<span id="cb5-72">            env_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> find_dotenv()</span>
<span id="cb5-73">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> env_file:</span>
<span id="cb5-74">                load_dotenv(env_file)</span>
<span id="cb5-75">                _logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"📁 .env読み込み: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>env_file<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-76">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ImportError</span>:</span>
<span id="cb5-77">            _logger.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"📁 dotenvモジュールなし - 環境変数のみ使用"</span>)</span>
<span id="cb5-78"></span>
<span id="cb5-79">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># プロファイル指定チェック</span></span>
<span id="cb5-80">        profile_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.environ.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_CONFIG_PROFILE"</span>)</span>
<span id="cb5-81"></span>
<span id="cb5-82">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> profile_name:</span>
<span id="cb5-83">            _logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"🔧 .databrickscfgプロファイル使用: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>profile_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-84"></span>
<span id="cb5-85">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> os.environ.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_CLUSTER_ID"</span>):</span>
<span id="cb5-86">                cluster_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.environ.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_CLUSTER_ID"</span>)</span>
<span id="cb5-87">                spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb5-88">                    DatabricksSession.builder.profile(profile_name)</span>
<span id="cb5-89">                    .clusterId(cluster_id)</span>
<span id="cb5-90">                    .getOrCreate()</span>
<span id="cb5-91">                )</span>
<span id="cb5-92">                _logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"🆔 クラスター使用: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cluster_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-93">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb5-94">                spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb5-95">                    DatabricksSession.builder.profile(profile_name)</span>
<span id="cb5-96">                    .serverless(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-97">                    .getOrCreate()</span>
<span id="cb5-98">                )</span>
<span id="cb5-99">                _logger.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚀 Serverless Compute使用"</span>)</span>
<span id="cb5-100">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb5-101">            _logger.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🔧 環境変数から直接接続"</span>)</span>
<span id="cb5-102"></span>
<span id="cb5-103">            required_vars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_HOST"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_TOKEN"</span>]</span>
<span id="cb5-104">            missing_vars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [var <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> var <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> required_vars <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> os.environ.get(var)]</span>
<span id="cb5-105"></span>
<span id="cb5-106">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> missing_vars:</span>
<span id="cb5-107">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"環境変数が未設定: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>missing_vars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-108"></span>
<span id="cb5-109">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> os.environ.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_CLUSTER_ID"</span>):</span>
<span id="cb5-110">                cluster_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.environ.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_CLUSTER_ID"</span>)</span>
<span id="cb5-111">                spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DatabricksSession.builder.clusterId(cluster_id).getOrCreate()</span>
<span id="cb5-112">                _logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"🆔 クラスター使用: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cluster_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-113">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb5-114">                spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DatabricksSession.builder.serverless(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>).getOrCreate()</span>
<span id="cb5-115">                _logger.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚀 Serverless Compute使用"</span>)</span>
<span id="cb5-116"></span>
<span id="cb5-117">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DataFrame表示最適化（Serverless環境では一部設定が制限される）</span></span>
<span id="cb5-118">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb5-119">            spark.conf.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spark.sql.repl.eagerEval.enabled"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-120">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>:</span>
<span id="cb5-121">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Serverless Computeでは設定できない場合があるのでスキップ</span></span>
<span id="cb5-122">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">pass</span></span>
<span id="cb5-123"></span>
<span id="cb5-124">        _logger.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"✅ Databricks Connect Sparkセッション作成完了"</span>)</span>
<span id="cb5-125">        _logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"📊 Spark version: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>spark<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-126">        _logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"🌐 接続先: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>spark<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>client<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>host<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-127">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> spark</span>
<span id="cb5-128"></span>
<span id="cb5-129">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ImportError</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb5-130">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ImportError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"databricks-connectが利用できません: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-131"></span>
<span id="cb5-132"></span>
<span id="cb5-133"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_spark_session():</span>
<span id="cb5-134">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""実行環境に応じて適切なSparkセッションを作成"""</span></span>
<span id="cb5-135">    env_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_environment_type()</span>
<span id="cb5-136">    _logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"🔍 実行環境検出: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>env_type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-137"></span>
<span id="cb5-138">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb5-139">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> env_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"databricks"</span>:</span>
<span id="cb5-140">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> create_databricks_native_session()</span>
<span id="cb5-141">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># local環境（VS Code、Cursor、Dev Container CLI等）</span></span>
<span id="cb5-142">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> create_local_connect_session()</span>
<span id="cb5-143"></span>
<span id="cb5-144">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb5-145">        error_msg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)</span>
<span id="cb5-146">        _logger.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"❌ Sparkセッション作成失敗: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>error_msg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-147"></span>
<span id="cb5-148">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># バージョン不整合の検出と対応提案</span></span>
<span id="cb5-149">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unsupported combination"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> error_msg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Databricks Runtime"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> error_msg:</span>
<span id="cb5-150">            _logger.error(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🔧 バージョン不整合が検出されました"</span>)</span>
<span id="cb5-151">            _logger.error(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"💡 以下のいずれかの対応を行ってください:"</span>)</span>
<span id="cb5-152">            _logger.error(</span>
<span id="cb5-153">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"   1. DatabricksConnectをクラスターのランタイムに合わせてダウングレード:"</span></span>
<span id="cb5-154">            )</span>
<span id="cb5-155">            _logger.error(</span>
<span id="cb5-156">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"      uv add 'databricks-connect~=[クラスターのランタイムバージョン]'"</span></span>
<span id="cb5-157">            )</span>
<span id="cb5-158">            _logger.error(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"   2. Databricksクラスターのランタイムをアップグレード"</span>)</span>
<span id="cb5-159"></span>
<span id="cb5-160">        _logger.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"💡 環境タイプ: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>env_type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-161">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span></span>
<span id="cb5-162"></span>
<span id="cb5-163"></span>
<span id="cb5-164"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 明示的にcreate_spark_session()を呼び出してセッションを作成してください</span></span>
<span id="cb5-165"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 例: spark = create_spark_session()</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="databricks側の設定" class="level2">
<h2 class="anchored" data-anchor-id="databricks側の設定">6. Databricks側の設定</h2>
<section id="接続先クラスタ設定" class="level3">
<h3 class="anchored" data-anchor-id="接続先クラスタ設定">6.1. 接続先クラスタ設定</h3>
<p>Spark config で以下を設定します。</p>
<pre><code>spark.databricks.service.server.enabled true</code></pre>
</section>
<section id="databricks-接続設定" class="level3">
<h3 class="anchored" data-anchor-id="databricks-接続設定">6.2. Databricks 接続設定</h3>
<p>Databricks へ接続する場合は <code>~/.databrickscfg</code> に以下の内容を記述します。</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[DEFAULT]</span></span>
<span id="cb7-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">host </span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> https://your-databricks-workspace.cloud.databricks.com</span></span>
<span id="cb7-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">token </span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> your-access-token</span></span></code></pre></div>
<ul>
<li><code>host</code>: Databricks ワークスペースの URL</li>
<li><code>token</code>: Databricks アクセストークン</li>
</ul>
</section>
</section>
<section id="利用手順" class="level2">
<h2 class="anchored" data-anchor-id="利用手順">7. 利用手順</h2>
<section id="env-作成" class="level3">
<h3 class="anchored" data-anchor-id="env-作成">7.1. <code>.env</code> 作成</h3>
<ol type="1">
<li><p><code>.env</code> ファイルを作成します</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cp</span> .env.example .env</span></code></pre></div></li>
<li><p>必要であれば <code>.env</code> ファイルの内容を変更してください</p></li>
</ol>
</section>
<section id="開発ワークフロー" class="level3">
<h3 class="anchored" data-anchor-id="開発ワークフロー">7.2. 開発ワークフロー</h3>
<ol type="1">
<li>Dev Container を起動</li>
<li>Python カーネルを選択</li>
<li>Spark セッションを作成して開発開始</li>
</ol>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> databricks_spark <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> create_spark_session</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sparkセッション作成</span></span>
<span id="cb9-4">spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_spark_session()</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># データの取得</span></span>
<span id="cb9-7">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spark.sql(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT * FROM your_table LIMIT 10"</span>)</span>
<span id="cb9-8">df.show()</span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># データ分析</span></span>
<span id="cb9-11">df.groupBy(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category"</span>).count().show()</span></code></pre></div>
</section>
</section>
<section id="ノートブックでの-python-モジュールインストール方法" class="level2">
<h2 class="anchored" data-anchor-id="ノートブックでの-python-モジュールインストール方法">8. ノートブックでの Python モジュールインストール方法</h2>
<p>Databricks での実行時のみ Python パッケージをインストールする HACK な方法です。</p>
<p>uv を使っていない場合は <code>%pip install &lt;package&gt;</code> で大丈夫です。</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb10-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> os.environ.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATABRICKS_RUNTIME_VERSION"</span>):</span>
<span id="cb10-3">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>pip install uv</span>
<span id="cb10-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>pip install <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>(uv pip <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span> pyproject.toml <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>color never)</span></code></pre></div>
</section>
<section id="トラブルシューティング" class="level2">
<h2 class="anchored" data-anchor-id="トラブルシューティング">9. トラブルシューティング</h2>
<section id="バージョン不整合エラー" class="level3">
<h3 class="anchored" data-anchor-id="バージョン不整合エラー">9.1. バージョン不整合エラー</h3>
<p>Databricks Connect のバージョンとクラスタのランタイムバージョンが合わない場合があります</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># クラスタのランタイムに合わせてダウングレード</span></span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> add <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'databricks-connect~=14.3.0'</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># この場合は DBR 14.3 に対応</span></span></code></pre></div>
</section>
<section id="接続エラー" class="level3">
<h3 class="anchored" data-anchor-id="接続エラー">9.2. 接続エラー</h3>
<p>設定ファイルが存在せずマウントされていない場合が考えられるので、devcontainer.json の <code>mounts</code> 設定を確認してください。</p>
</section>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">10. おわりに</h2>
<p>これでローカル開発環境から Databricks の Spark クラスタを利用できるようになりました。</p>
<p>Claude Code にノートブック実行とデバッグを任せることでデータサイエンスや機械学習の作業効率が爆上がりですね！</p>
<p>Claude Code にこの手の作業を任せるときは時間がかかるので並行して他の作業に取り組むのがオススメです。</p>
</section>
<section id="おまけ-claude-code-に読ませると便利なルール" class="level2">
<h2 class="anchored" data-anchor-id="おまけ-claude-code-に読ませると便利なルール">11. (おまけ) Claude Code に読ませると便利なルール</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>CONTRIBUTING.md</strong></pre>
</div>
<div class="sourceCode" id="cb12" data-filename="CONTRIBUTING.md" style="background: #f1f3f5;"><pre class="sourceCode md code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"># CONTRIBUTING</span></span>
<span id="cb12-2"></span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## 重要なルール</span></span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### pre-commit 設定について</span></span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>**NEVER**: pre-commit を無効化してはならない</span>
<span id="cb12-8"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>**NEVER**: <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`pre-commit skip`</span> や <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`git commit --no-verify`</span> を使用してはならない</span>
<span id="cb12-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>**IMPORTANT**: pre-commit のチェックに失敗した場合は、必ずコードを修正してからコミットする</span>
<span id="cb12-10"></span>
<span id="cb12-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Jupyter Notebook 実行方法</span></span>
<span id="cb12-12"></span>
<span id="cb12-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### デフォルトの実行方法</span></span>
<span id="cb12-14"></span>
<span id="cb12-15">Notebook全体を実行する指示を受けた際は、以下のコマンドを使用する</span>
<span id="cb12-16"></span>
<span id="cb12-17"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`uv run jupyter nbconvert --to notebook --execute &lt;notebook_path&gt; --inplace --ExecutePreprocessor.timeout=300`</span></span>
<span id="cb12-18"></span>
<span id="cb12-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">#### 使用例</span></span>
<span id="cb12-20"></span>
<span id="cb12-21"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`uv run jupyter nbconvert --to notebook --execute /workspace/notebooks/databricks-connect-sample.ipynb --inplace --ExecutePreprocessor.timeout=300`</span></span>
<span id="cb12-22"></span>
<span id="cb12-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">#### オプション説明</span></span>
<span id="cb12-24"></span>
<span id="cb12-25"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`--to notebook`</span>: Notebook形式で出力</span>
<span id="cb12-26"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`--execute`</span>: セルを実際に実行</span>
<span id="cb12-27"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`--inplace`</span>: 元のファイルに実行結果を上書き</span>
<span id="cb12-28"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`--ExecutePreprocessor.timeout=300`</span>: タイムアウトを300秒に設定</span>
<span id="cb12-29"></span>
<span id="cb12-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### 実行ログの確認</span></span>
<span id="cb12-31"></span>
<span id="cb12-32">実行時のログを確認したい場合は以下のように実行する</span>
<span id="cb12-33"></span>
<span id="cb12-34"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`uv run jupyter nbconvert --to notebook --execute &lt;notebook_path&gt; --inplace --ExecutePreprocessor.timeout=300 2&gt;&amp;1 | tee /tmp/notebook_execution.log`</span></span>
<span id="cb12-35"></span>
<span id="cb12-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### 注意事項</span></span>
<span id="cb12-37"></span>
<span id="cb12-38"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>実行前に必要な環境変数（<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`.env`</span>ファイル等）が適切に設定されていることを確認する</span>
<span id="cb12-39"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>長時間実行されるセルがある場合は<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`--ExecutePreprocessor.timeout`</span>の値を調整する</span>
<span id="cb12-40"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>VS Codeで開いている場合は実行後にファイルの更新を確認する</span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-python</category>
  <category>tech-databricks</category>
  <guid>https://i9wa4.github.io/blog/2025-07-28-article3-databricks-connect.html</guid>
  <pubDate>Sun, 27 Jul 2025 16:54:03 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Python 開発環境最適化編 ― uv + pre-commit + GitHub Actions</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-07-28-article2-python-env.html</link>
  <description><![CDATA[ 





<p>本記事は3部構成の2本目です。</p>
<ol type="1">
<li><a href="../blog/2025-07-28-article1-devcontainer.html">Claude Code 対応 Dev Container 環境構築編 - VS Code でもそれ以外でも</a></li>
<li><a href="../blog/2025-07-28-article2-python-env.html">Python 開発環境最適化編 - uv + pre-commit + GitHub Actions</a></li>
<li><a href="../blog/2025-07-28-article3-databricks-connect.html">Databricks Connect 実践編 - ローカルから Databricks コンピュートを利用</a></li>
</ol>
<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>前回の Dev Container 環境に Python 開発環境を追加します。</p>
<p>uv によるパッケージ管理と pre-commit による品質管理で、チーム開発でも個人開発でも快適な Python 環境を構築できます。</p>
</section>
<section id="対象読者" class="level2">
<h2 class="anchored" data-anchor-id="対象読者">2. 対象読者</h2>
<ul>
<li>Python開発環境を効率化したい方</li>
<li>チーム開発でコード品質を統一したい方</li>
<li>VS Code以外のエディタでも同じ環境を使いたい方</li>
</ul>
</section>
<section id="uv-とは" class="level2">
<h2 class="anchored" data-anchor-id="uv-とは">3. uv とは</h2>
<p>今回利用している Python 環境管理ツールです。</p>
<p><a href="https://github.com/astral-sh/uv" class="uri">https://github.com/astral-sh/uv</a></p>
<p>最低限理解しておくべき要点は以下です。</p>
<ul>
<li>uv 自体は Python エコシステムの外にあるツール</li>
<li>インストールしたい Python パッケージを <code>pyproject.toml</code> で管理する</li>
<li><code>pyproject.toml</code> のパッケージの依存関係解決結果を <code>uv.lock</code> に保存し環境の再現性を担保している</li>
</ul>
</section>
<section id="python-環境設定" class="level2">
<h2 class="anchored" data-anchor-id="python-環境設定">4. Python 環境設定</h2>
<p>Python コーディング向け環境設定について説明していきます。</p>
<p>基本的なライブラリと pre-commit で Black isort, flake8 を利用していきます。</p>
<section id="pyproject.toml" class="level3">
<h3 class="anchored" data-anchor-id="pyproject.toml">4.1. pyproject.toml</h3>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>pyproject.toml</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="pyproject.toml" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-project-name"</span></span>
<span id="cb1-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.1.0"</span></span>
<span id="cb1-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">description</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Add your description here"</span></span>
<span id="cb1-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">requires-python</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~=3.13.0"</span></span>
<span id="cb1-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb1-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ipykernel"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-8">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jupyterlab"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-9">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matplotlib"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-10">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numpy"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-11">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pandas"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-12">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python-dotenv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-13">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"requests"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-14">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seaborn"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[dependency-groups]</span></span>
<span id="cb1-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dev</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb1-19">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pre-commit~=4.2.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-20">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black==25.1.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-21">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isort==6.0.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-22">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"flake8==7.3.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-23">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"flake8-pyproject"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-24"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.black]</span></span>
<span id="cb1-27"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">line-length</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">88</span></span>
<span id="cb1-28"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">target-version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">py313</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb1-29"></span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.isort]</span></span>
<span id="cb1-31"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">profile</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb1-32"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">line_length</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">88</span></span>
<span id="cb1-33"></span>
<span id="cb1-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.flake8]</span></span>
<span id="cb1-35"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">max-line-length</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">88</span></span>
<span id="cb1-36"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">extend-exclude</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".venv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb1-37"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">extend-ignore</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb1-38">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E203"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Whitespace before ':'</span></span>
<span id="cb1-39">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E701"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiple statements on one line (colon)</span></span>
<span id="cb1-40"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</div>
</section>
<section id="pre-commit-設定" class="level3">
<h3 class="anchored" data-anchor-id="pre-commit-設定">4.2. pre-commit 設定</h3>
<p>Formatter設定をVS Codeから切り離すことでVS Code以外のエディタやGitHub Actionsでも利用できるようになります。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.pre-commit-config.yaml</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename=".pre-commit-config.yaml" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default_stages</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pre-commit</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/pre-commit/pre-commit-hooks</span></span>
<span id="cb2-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v5.0.0</span></span>
<span id="cb2-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-added-large-files</span></span>
<span id="cb2-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-json</span></span>
<span id="cb2-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-yaml</span></span>
<span id="cb2-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> detect-private-key</span></span>
<span id="cb2-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> end-of-file-fixer</span></span>
<span id="cb2-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> mixed-line-ending</span></span>
<span id="cb2-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">args</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--fix=</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">no</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb2-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> trailing-whitespace</span></span>
<span id="cb2-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">args</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--markdown-linebreak-ext=md</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> local</span></span>
<span id="cb2-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> black</span></span>
<span id="cb2-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> black</span></span>
<span id="cb2-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entry</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> uv run --no-sync black</span></span>
<span id="cb2-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">language</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> system</span></span>
<span id="cb2-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb2-23"></span>
<span id="cb2-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> local</span></span>
<span id="cb2-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> isort</span></span>
<span id="cb2-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> isort (python)</span></span>
<span id="cb2-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entry</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> uv run --no-sync isort</span></span>
<span id="cb2-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">language</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> system</span></span>
<span id="cb2-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb2-31"></span>
<span id="cb2-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> local</span></span>
<span id="cb2-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> flake8</span></span>
<span id="cb2-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> flake8</span></span>
<span id="cb2-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entry</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> uv run --no-sync flake8</span></span>
<span id="cb2-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">language</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> system</span></span>
<span id="cb2-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb2-39"></span>
<span id="cb2-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/gitleaks/gitleaks</span></span>
<span id="cb2-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v8.28.0</span></span>
<span id="cb2-42"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> gitleaks</span></span></code></pre></div>
</div>
</section>
<section id="github-actions-での-pre-commit" class="level3">
<h3 class="anchored" data-anchor-id="github-actions-での-pre-commit">4.3. GitHub Actions での pre-commit</h3>
<p>GitHub Actionsでpre-commitを実行するための設定です。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/pre-commit.yaml</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename=".github/workflows/pre-commit.yaml" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pre-commit</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run-name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ github.event_name }} on ${{ github.ref_name }} by @${{ github.actor }}</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow_dispatch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">branches</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> main</span></span>
<span id="cb3-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull_request</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">branches</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> main</span></span>
<span id="cb3-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> opened</span></span>
<span id="cb3-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> synchronize</span></span>
<span id="cb3-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> reopened</span></span>
<span id="cb3-16"></span>
<span id="cb3-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">permissions</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{}</span></span>
<span id="cb3-18"></span>
<span id="cb3-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">defaults</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shell</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> bash</span></span>
<span id="cb3-22"></span>
<span id="cb3-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">concurrency</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ github.workflow }}-${{ github.ref }}</span></span>
<span id="cb3-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cancel-in-progress</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb3-26"></span>
<span id="cb3-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pre-commit</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb3-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">timeout-minutes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb3-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">permissions</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contents</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> read</span></span>
<span id="cb3-33"></span>
<span id="cb3-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Checkout</span></span>
<span id="cb3-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v4</span></span>
<span id="cb3-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">          # プルリクエスト時はソースブランチ(github.head_ref)を、</span></span>
<span id="cb3-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">          # 手動実行時は実行対象ブランチ(github.ref_name)をチェックアウト</span></span>
<span id="cb3-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ref</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ github.event_name == 'pull_request' &amp;&amp; github.head_ref || github.ref_name }}</span></span>
<span id="cb3-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">persist-credentials</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb3-42"></span>
<span id="cb3-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install uv</span></span>
<span id="cb3-44"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> astral-sh/setup-uv@v6</span></span>
<span id="cb3-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.8.3"</span></span>
<span id="cb3-47"></span>
<span id="cb3-48"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Set up Python</span></span>
<span id="cb3-49"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-50">          uv sync --only-group dev</span>
<span id="cb3-51"></span>
<span id="cb3-52"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Cache pre-commit</span></span>
<span id="cb3-53"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/cache@v4</span></span>
<span id="cb3-54"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-55"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ~/.cache/pre-commit</span></span>
<span id="cb3-56"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">          key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-57">            pre-commit-${{ runner.os }}-${{ hashFiles('.pre-commit-config.yaml') }}-${{ hashFiles('uv.lock') }}</span>
<span id="cb3-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">          # </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">NOTE</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: 設定ファイルの変更時に必ずキャッシュを更新する</span></span>
<span id="cb3-59"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">          restore-keys</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-60">            pre-commit-${{ runner.os }}-${{ hashFiles('.pre-commit-config.yaml') }}-${{ hashFiles('uv.lock') }}</span>
<span id="cb3-61"></span>
<span id="cb3-62"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install pre-commit</span></span>
<span id="cb3-63"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-64">          uv run --no-sync pre-commit install</span>
<span id="cb3-65"></span>
<span id="cb3-66"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Run pre-commit</span></span>
<span id="cb3-67"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-68">          uv run --no-sync pre-commit run --all-files</span></code></pre></div>
</div>
</section>
</section>
<section id="dev-container-への統合" class="level2">
<h2 class="anchored" data-anchor-id="dev-container-への統合">5. Dev Container への統合</h2>
<section id="devcontainer.json-の更新" class="level3">
<h3 class="anchored" data-anchor-id="devcontainer.json-の更新">5.1. devcontainer.json の更新</h3>
<p>前回の devcontainer.json に以下の設定を追加します。</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"customizations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-3">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vscode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-4">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"extensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb4-5">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"editorconfig.editorconfig"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-6">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elagil.pre-commit-helper"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-7">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms-python.python"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-8">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms-toolsai.jupyter"</span></span>
<span id="cb4-9">            <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-10">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb4-12">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"remoteEnv"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-13">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"UV_LINK_MODE"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"copy"</span></span>
<span id="cb4-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb4-15">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"postStartCommand"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uv sync --frozen --group dev &amp;&amp; uv run pre-commit install"</span></span>
<span id="cb4-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="jupyterlab-起動スクリプト" class="level3">
<h3 class="anchored" data-anchor-id="jupyterlab-起動スクリプト">5.2. JupyterLab 起動スクリプト</h3>
<p>VS Code ユーザーは不要ですが一応 JupyterLab を起動するスクリプトも用意しました。</p>
<p>ポートは自動割り当てにしています。</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
5.2.1. <code>.devcontainer/start-jupyter.sh</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.devcontainer/start-jupyter.sh</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename=".devcontainer/start-jupyter.sh" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/usr/bin/env bash</span></span>
<span id="cb5-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> errexit</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># JupyterLab起動スクリプト</span></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 快適な開発用</span></span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🔥 JupyterLab 環境を起動中..."</span></span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ポート設定（環境変数または自動割り当て）</span></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># JUPYTER_PORT=8888 # </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">NOTE</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: この行をコメントアウトすると自動ポート検索が有効になります</span></span>
<span id="cb5-11"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">JUPYTER_PORT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${JUPYTER_PORT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:-</span>0<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$JUPYTER_PORT</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0"</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb5-14">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"📡 利用可能なポートを自動検索中..."</span></span>
<span id="cb5-15"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span></span>
<span id="cb5-16">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"📡 指定ポート </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${JUPYTER_PORT}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> で起動します"</span></span>
<span id="cb5-17"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fi</span></span>
<span id="cb5-18"></span>
<span id="cb5-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Python環境の確認</span></span>
<span id="cb5-20"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-f</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uv.lock"</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb5-21">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"📦 uv環境を使用してJupyterLabを起動します"</span></span>
<span id="cb5-22">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> sync <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--frozen</span></span>
<span id="cb5-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nohup</span> uv run jupyter lab <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ip</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0.0.0.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${JUPYTER_PORT}</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--no-browser</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allow-root</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--NotebookApp.token</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--NotebookApp.password</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ServerApp.allow_origin</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'*'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ServerApp.disable_check_xsrf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>True <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/dev/null <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span></span>
<span id="cb5-26"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".venv"</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb5-27">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"📦 venv環境を使用してJupyterLabを起動します"</span></span>
<span id="cb5-28">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">source</span> .venv/bin/activate</span>
<span id="cb5-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nohup</span> jupyter lab <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ip</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0.0.0.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${JUPYTER_PORT}</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--no-browser</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allow-root</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--NotebookApp.token</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--NotebookApp.password</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ServerApp.allow_origin</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'*'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ServerApp.disable_check_xsrf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>True <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/dev/null <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span></span>
<span id="cb5-32"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span></span>
<span id="cb5-33">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"❌ Python仮想環境が見つかりません"</span></span>
<span id="cb5-34">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uvまたはvenvで環境をセットアップしてください"</span></span>
<span id="cb5-35">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span> 1</span>
<span id="cb5-36"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fi</span></span>
<span id="cb5-37"></span>
<span id="cb5-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 実際に割り当てられたポートを取得（リトライ機能付き）</span></span>
<span id="cb5-39"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">..</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span></span>
<span id="cb5-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 1</span>
<span id="cb5-41">  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ACTUAL_PORT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ss</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-tlnp</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/dev/null <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> jupyter-lab <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">awk</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{print $4}'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d:</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-1</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-42">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ACTUAL_PORT</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb5-43">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span></span>
<span id="cb5-44">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fi</span></span>
<span id="cb5-45"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span></span>
<span id="cb5-46"></span>
<span id="cb5-47"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$JUPYTER_PORT</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0"</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ACTUAL_PORT</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb5-48">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🌐 JupyterLabは http://localhost:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${ACTUAL_PORT}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/lab でアクセス可能です"</span></span>
<span id="cb5-49"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span></span>
<span id="cb5-50">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🌐 JupyterLabは http://localhost:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${JUPYTER_PORT}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/lab でアクセス可能です"</span></span>
<span id="cb5-51"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fi</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="python-仮想環境更新手順" class="level2">
<h2 class="anchored" data-anchor-id="python-仮想環境更新手順">6. Python 仮想環境更新手順</h2>
<ol type="1">
<li><p>必要に応じて <code>.python-version</code> や <code>pyproject.toml</code> を更新します。</p></li>
<li><p><code>uv.lock</code> を更新します。</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> uv lock <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--upgrade</span></span></code></pre></div></li>
<li><p>.venv を更新します。</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> uv sync <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--frozen</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--group</span> dev</span></code></pre></div></li>
</ol>
<section id="パッケージ追加手順" class="level3">
<h3 class="anchored" data-anchor-id="パッケージ追加手順">6.1. パッケージ追加手順</h3>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 新しいパッケージを追加</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> add pandas matplotlib</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 開発用パッケージを追加</span></span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> add <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--group</span> dev pytest</span></code></pre></div>
</section>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">7. おわりに</h2>
<p>これで Python 開発環境が完成しました。</p>
<p>次回はこの環境に Databricks Connect を追加してクラウドデータウェアハウスと連携する方法を紹介します。</p>
<p><a href="../blog/2025-07-28-article3-databricks-connect.html">Databricks Connect 実践編 - ローカルから Databricks コンピュートを利用</a></p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-python</category>
  <category>tech-vscode</category>
  <guid>https://i9wa4.github.io/blog/2025-07-28-article2-python-env.html</guid>
  <pubDate>Sun, 27 Jul 2025 16:53:58 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Claude Code 対応 Dev Container 環境構築編 ― VS Code でもそれ以外でも</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-07-28-article1-devcontainer.html</link>
  <description><![CDATA[ 





<p>本記事は3部構成の1本目です。</p>
<ol type="1">
<li><a href="../blog/2025-07-28-article1-devcontainer.html">Claude Code 対応 Dev Container 環境構築編 - VS Code でもそれ以外でも</a></li>
<li><a href="../blog/2025-07-28-article2-python-env.html">Python 開発環境最適化編 - uv + pre-commit + GitHub Actions</a></li>
<li><a href="../blog/2025-07-28-article3-databricks-connect.html">Databricks Connect 実践編 - ローカルから Databricks コンピュートを利用</a></li>
</ol>
<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>Claude Codeを使いたいけれど環境構築が面倒、チーム全員に同じ開発環境を提供したい、そんな悩みをサクッと解決します。</p>
<p>この記事では Anthropic のリファレンス実装をベースに、実用的にカスタマイズしたDev Container設定を紹介します。</p>
</section>
<section id="対象読者" class="level2">
<h2 class="anchored" data-anchor-id="対象読者">2. 対象読者</h2>
<ul>
<li>Claude Code を使いたいが環境構築を簡単にしたい方</li>
<li>チーム開発で統一された開発環境を提供したい方</li>
</ul>
</section>
<section id="前提知識" class="level2">
<h2 class="anchored" data-anchor-id="前提知識">3. 前提知識</h2>
<section id="dev-container-とは" class="level3">
<h3 class="anchored" data-anchor-id="dev-container-とは">3.1. Dev Container とは</h3>
<p>Dev Container は VS Code でコンテナを開発環境として利用できる便利機能です。</p>
<p>今回の設定をチームで共有すれば全員に同じ開発環境を提供できます。</p>
<p>VS Code以外のエディタでも Dev Container CLI を利用することで恩恵を受けることができます。</p>
</section>
<section id="claude-code-in-dev-container" class="level3">
<h3 class="anchored" data-anchor-id="claude-code-in-dev-container">3.2. Claude Code in Dev Container</h3>
<p>Claude Code を Dev Container で利用する方法について2通り紹介します。</p>
<section id="devcontainer.json-の-features-を利用する" class="level4">
<h4 class="anchored" data-anchor-id="devcontainer.json-の-features-を利用する">3.2.1. devcontainer.json の features を利用する</h4>
<p>こちらが簡単な方法です。</p>
<p>以下に Anthropic が提供している Dev Container feature を利用する方法が記載されています。</p>
<p><a href="https://github.com/anthropics/devcontainer-features/blob/main/src/claude-code/README.md" class="uri">https://github.com/anthropics/devcontainer-features/blob/main/src/claude-code/README.md</a></p>
<p>抜粋すると以下の通りです。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.devcontainer/devcontainer.json</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename=".devcontainer/devcontainer.json" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"features":</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/devcontainers/features/node:1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{},</span></span>
<span id="cb1-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"ghcr.io/anthropics/devcontainer-features/claude-code:1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
</section>
<section id="dockerfile-を利用する" class="level4">
<h4 class="anchored" data-anchor-id="dockerfile-を利用する">3.2.2. Dockerfile を利用する</h4>
<p>本家のリファレンス実装を利用する方法です。</p>
<p>以下が Claude Code 向け Dev Container について記載されている公式ドキュメントです。</p>
<p><a href="https://docs.anthropic.com/en/docs/claude-code/devcontainer" class="uri">https://docs.anthropic.com/en/docs/claude-code/devcontainer</a></p>
<p>この中でリファレンス実装として Claude Code 自身の Dev Container 設定が紹介されています。</p>
<p><a href="https://github.com/anthropics/claude-code/tree/main/.devcontainer" class="uri">https://github.com/anthropics/claude-code/tree/main/.devcontainer</a></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.devcontainer</span></span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> devcontainer.json</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> Dockerfile</span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> init-firewall.sh</span></code></pre></div>
<p>このリファレンス実装を参考にしつつ私が使いやすいようにカスタマイズしたものを以下で紹介していきます。</p>
</section>
</section>
</section>
<section id="dev-container-設定" class="level2">
<h2 class="anchored" data-anchor-id="dev-container-設定">4. Dev Container 設定</h2>
<section id="vs-code-側の準備" class="level3">
<h3 class="anchored" data-anchor-id="vs-code-側の準備">4.1. VS Code 側の準備</h3>
<p>Dev Container 拡張をインストールしておく必要があります。</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" class="uri">https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers</a></p>
</section>
<section id="dockerfile" class="level3">
<h3 class="anchored" data-anchor-id="dockerfile">4.2. Dockerfile</h3>
<p>Anthropic のリファレンス実装をベースにして以下のような Dockerfile を作成しました。</p>
<p>見て分かる通り hadolint で結構指摘が出る書き味ですが特に意思もないのでそのままにしています。</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
4.2.1. <code>.devcontainer/Dockerfile</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.devcontainer/Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename=".devcontainer/Dockerfile" style="background: #f1f3f5;"><pre class="sourceCode Dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> node:20</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ARG</span> TZ</span>
<span id="cb3-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ENV</span> TZ=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$TZ"</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install basic development tools and iptables/ipset</span></span>
<span id="cb3-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">apt</span> update <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">apt</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-y</span> less <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-8">  git <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-9">  procps <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-10">  sudo <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-11">  fzf <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-12">  zsh <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-13">  man-db <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-14">  unzip <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-15">  gnupg2 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-16">  gh <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-17">  iptables <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-18">  ipset <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-19">  iproute2 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-20">  dnsutils <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-21">  aggregate <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-22">  jq</span>
<span id="cb3-23"></span>
<span id="cb3-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure default node user has access to /usr/local/share</span></span>
<span id="cb3-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> /usr/local/share/npm-global <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chown</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-R</span> node:node /usr/local/share</span>
<span id="cb3-27"></span>
<span id="cb3-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ARG</span> USERNAME=node</span>
<span id="cb3-29"></span>
<span id="cb3-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Persist bash history.</span></span>
<span id="cb3-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">SNIPPET</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"export PROMPT_COMMAND='history -a' &amp;&amp; export HISTFILE=/commandhistory/.bash_history"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-32">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> /commandhistory <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-33">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">touch</span> /commandhistory/.bash_history <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-34">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chown</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-R</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$USERNAME</span> /commandhistory</span>
<span id="cb3-35"></span>
<span id="cb3-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set `DEVCONTAINER` environment variable to help with orientation</span></span>
<span id="cb3-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ENV</span> DEVCONTAINER=true</span>
<span id="cb3-38"></span>
<span id="cb3-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create workspace and config directories and set permissions</span></span>
<span id="cb3-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> /workspace /home/node/.claude <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chown</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-R</span> node:node /workspace /home/node/.claude</span>
<span id="cb3-42"></span>
<span id="cb3-43"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">WORKDIR</span> /workspace</span>
<span id="cb3-44"></span>
<span id="cb3-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ARCH</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dpkg</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--print-architecture</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/dandavison/delta/releases/download/0.18.2/git-delta_0.18.2_</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${ARCH}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.deb"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> dpkg <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git-delta_0.18.2_</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${ARCH}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.deb"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git-delta_0.18.2_</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${ARCH}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.deb"</span></span>
<span id="cb3-49"></span>
<span id="cb3-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set up non-root user</span></span>
<span id="cb3-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">USER</span> node</span>
<span id="cb3-52"></span>
<span id="cb3-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install global packages</span></span>
<span id="cb3-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ENV</span> NPM_CONFIG_PREFIX=/usr/local/share/npm-global</span>
<span id="cb3-55"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ENV</span> PATH=$PATH:/usr/local/share/npm-global/bin</span>
<span id="cb3-56"></span>
<span id="cb3-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the default shell to zsh rather than sh</span></span>
<span id="cb3-58"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ENV</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SHELL</span>=/bin/zsh</span>
<span id="cb3-59"></span>
<span id="cb3-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Default powerline10k theme</span></span>
<span id="cb3-61"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-O-</span> https://github.com/deluan/zsh-in-docker/releases/download/v1.2.0/zsh-in-docker.sh<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-62">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> git <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-63">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> fzf <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-64">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source /usr/share/doc/fzf/examples/key-bindings.zsh"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-65">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source /usr/share/doc/fzf/examples/completion.zsh"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-66">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"export PROMPT_COMMAND='history -a' &amp;&amp; export HISTFILE=/commandhistory/.bash_history"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-67">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-x</span></span>
<span id="cb3-68"></span>
<span id="cb3-69"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install Claude</span></span>
<span id="cb3-70"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">npm</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-g</span> @anthropic-ai/claude-code</span>
<span id="cb3-71"></span>
<span id="cb3-72"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Python environment setup (if needed)</span></span>
<span id="cb3-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Copy uv binary from official image</span></span>
<span id="cb3-74"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">COPY</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--from=ghcr.io/astral-sh/uv:latest</span> /uv /usr/local/bin/uv</span>
<span id="cb3-75"></span>
<span id="cb3-76"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">USER</span> node</span></code></pre></div>
</div>
<p>Anthropic のリファレンス実装 (<a href="https://github.com/anthropics/claude-code/blob/55219b8b4e612b5fc6a85f7dc4eb4382ec4134eb/.devcontainer/Dockerfile">e394b39</a>) と比較すると以下のような変更を行っています。</p>
<ul>
<li>firewall スクリプト対応部分を削除</li>
<li>uv インストール部分を追加</li>
</ul>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode diff code-with-copy"><code class="sourceCode diff"><span id="cb4-1">$ diff -u ../../anthropics/claude-code/.devcontainer/Dockerfile .devcontainer/Dockerfile</span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">--- ../../anthropics/claude-code/.devcontainer/Dockerfile       2025-07-26 16:16:50</span></span>
<span id="cb4-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">+++ .devcontainer/Dockerfile    2025-07-26 23:24:59</span></span>
<span id="cb4-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">@@ -69,10 +69,8 @@</span></span>
<span id="cb4-5"> # Install Claude</span>
<span id="cb4-6"> RUN npm install -g @anthropic-ai/claude-code</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-# Copy and set up firewall script</span></span>
<span id="cb4-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-COPY init-firewall.sh /usr/local/bin/</span></span>
<span id="cb4-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-USER root</span></span>
<span id="cb4-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-RUN chmod +x /usr/local/bin/init-firewall.sh &amp;&amp; \</span></span>
<span id="cb4-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-  echo "node ALL=(root) NOPASSWD: /usr/local/bin/init-firewall.sh" &gt; /etc/sudoers.d/node-firewall &amp;&amp; \</span></span>
<span id="cb4-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-  chmod 0440 /etc/sudoers.d/node-firewall</span></span>
<span id="cb4-14"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+# Python environment setup (if needed)</span></span>
<span id="cb4-15"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+# Copy uv binary from official image</span></span>
<span id="cb4-16"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+COPY --from=ghcr.io/astral-sh/uv:latest /uv /usr/local/bin/uv</span></span>
<span id="cb4-17"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-18"> USER node</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="devcontainer.json" class="level3">
<h3 class="anchored" data-anchor-id="devcontainer.json">4.3. devcontainer.json</h3>
<p>以下のような <code>devcontainer.json</code> を作成しました。</p>
<p>こちらは Anthropic のリファレンス実装に比べると割と変更点が多いです。</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
4.3.1. <code>.devcontainer/devcontainer.json</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.devcontainer/devcontainer.json</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename=".devcontainer/devcontainer.json" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Claude Code Development Environment"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"build"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-4">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dockerfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dockerfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"args"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-6">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"TZ"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"${localEnv:TZ:Asia/Tokyo}"</span></span>
<span id="cb5-7">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb5-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"runArgs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--cap-add=NET_ADMIN"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--cap-add=NET_RAW"</span></span>
<span id="cb5-12">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"customizations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-14">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vscode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-15">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"extensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-16">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"editorconfig.editorconfig"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-17">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elagil.pre-commit-helper"</span></span>
<span id="cb5-18">            <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-19">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"settings"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-20">                <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"terminal.integrated.defaultProfile.linux"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zsh"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-21">                <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"terminal.integrated.profiles.linux"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-22">                    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"bash"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-23">                        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"path"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bash"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-24">                        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"icon"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"terminal-bash"</span></span>
<span id="cb5-25">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb5-26">                    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"zsh"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-27">                        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"path"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zsh"</span></span>
<span id="cb5-28">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-29">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-30">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-31">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-32">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb5-33">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"remoteUser"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"node"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-34">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"mounts"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-35">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=${localEnv:CLAUDE_CONFIG_DIR},target=/home/node/.claude,type=bind,consistency=cached"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-36">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=${localEnv:HOME}/.config/gh,target=/home/node/.config/gh,type=bind,consistency=cached"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-37">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=${localEnv:HOME}/.config/git,target=/home/node/.config/git,type=bind,consistency=cached"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-38">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=${localEnv:HOME}/.gitconfig,target=/home/node/.gitconfig,type=bind,consistency=cached"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-39">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=${localEnv:HOME}/.ssh,target=/home/node/.ssh,type=bind,consistency=cached"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-40">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=claude-code-bashhistory-${devcontainerId},target=/commandhistory,type=volume"</span></span>
<span id="cb5-41">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-42">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"remoteEnv"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-43">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"CLAUDE_CONFIG_DIR"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/node/.claude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-44">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"NODE_OPTIONS"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--max-old-space-size=4096"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-45">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"POWERLEVEL9K_DISABLE_GITSTATUS"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"true"</span></span>
<span id="cb5-46">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb5-47">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"workspaceMount"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=delegated"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-48">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"workspaceFolder"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/workspace"</span></span>
<span id="cb5-49"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>Anthropic のリファレンス実装 (<a href="https://github.com/anthropics/claude-code/blob/55219b8b4e612b5fc6a85f7dc4eb4382ec4134eb/.devcontainer/devcontainer.json">33e37bd</a>) と比較すると以下のような変更を行っています。</p>
<ul>
<li>VS Code 向け拡張機能を追加
<ul>
<li><code>editorconfig.editorconfig</code>
<ul>
<li>テキストエディタ間での設定を統一する</li>
</ul></li>
<li><code>elagil.pre-commit-helper</code>
<ul>
<li>pre-commit を使いやすくする</li>
</ul></li>
</ul></li>
<li>VS Code 向け Formatter 設定を削除</li>
<li><code>mounts</code> に設定ファイル群を追加
<ul>
<li>以下のツールの設定ファイルをマウントして利用します
<ul>
<li>Claude Code</li>
<li>GitHub CLI</li>
<li>Git</li>
<li>ssh</li>
</ul></li>
</ul></li>
<li><code>mounts</code> の Claude Code 設定分離部分を削除
<ul>
<li>ユーザー設定をマウントして利用したかったので削除しました</li>
</ul></li>
<li><code>remoteEnv</code> に以下の環境変数を追加
<ul>
<li><code>CLAUDE_CONFIG_DIR</code>
<ul>
<li>Claude Code の設定参照箇所の安定化を図る</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="利用手順" class="level2">
<h2 class="anchored" data-anchor-id="利用手順">5. 利用手順</h2>
<section id="claude-code-設定" class="level3">
<h3 class="anchored" data-anchor-id="claude-code-設定">5.1. Claude Code 設定</h3>
<p>Claude Code の設定ディレクトリを環境変数で指定しておきます。</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">CLAUDE_CONFIG_DIR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$HOME</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/.claude"</span></span></code></pre></div>
</section>
<section id="dev-container-vs-code" class="level3">
<h3 class="anchored" data-anchor-id="dev-container-vs-code">5.2. Dev Container VS Code</h3>
<ol type="1">
<li>F1 -&gt; “Dev Containers: Open Folder in Container…” を選択します</li>
<li>Claude Code はインストール済みなのでターミナルから起動できます</li>
</ol>
</section>
<section id="dev-container-cli" class="level3">
<h3 class="anchored" data-anchor-id="dev-container-cli">5.3. Dev Container CLI</h3>
<p>VS Code を使わない場合は Dev Container CLI を利用できます。</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dev Container CLI のインストール</span></span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">npm</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-g</span> @devcontainers/cli</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># コンテナ起動</span></span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">devcontainer</span> up <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--workspace-folder</span> .</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># コンテナに接続</span></span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">devcontainer</span> exec <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--workspace-folder</span> . zsh</span></code></pre></div>
</section>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">6. おわりに</h2>
<p>これで Claude Code が使える開発環境の完成です。</p>
<p>次回はこの環境に Python 開発環境を追加する方法を紹介します。</p>
<p><a href="../blog/2025-07-28-article2-python-env.html">Python 開発環境最適化編 - uv + pre-commit + GitHub Actions</a></p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-ai</category>
  <category>tech-vscode</category>
  <guid>https://i9wa4.github.io/blog/2025-07-28-article1-devcontainer.html</guid>
  <pubDate>Sun, 27 Jul 2025 16:53:53 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>個人的ターミナル最適化 for Claude Code</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-07-16-zenn-2025-07-16-optimize-your-terminal-for-claude-code.html</link>
  <description><![CDATA[ 





<p>この記事は Zenn で公開されています。</p>
<p><a href="https://zenn.dev/i9wa4/articles/2025-07-16-optimize-your-terminal-for-claude-code">個人的ターミナル最適化 for Claude Code</a></p>



 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>zenn</category>
  <guid>https://i9wa4.github.io/blog/2025-07-16-zenn-2025-07-16-optimize-your-terminal-for-claude-code.html</guid>
  <pubDate>Wed, 16 Jul 2025 06:31:24 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/zenn-logo.png" medium="image" type="image/png" height="29" width="144"/>
</item>
<item>
  <title>個人的ターミナル最適化 for Claude Code</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-07-14-optimize-your-teminal-for-claude-code.html</link>
  <description><![CDATA[ 





<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>Claude Code で並行作業を行いやすくなるための工夫ポイントを全て共有します！</p>
<p>本当の私個人の趣味盛り盛りの内容なので役に立つ部分だけ読む形でお願いします。</p>
<p>なお分量が多いので参考記事やリンクを用意していない部分もあります。</p>
<p>インストール方法も各自で調べてください。</p>
</section>
<section id="対象読者" class="level2">
<h2 class="anchored" data-anchor-id="対象読者">2. 対象読者</h2>
<ul>
<li>Claude Code を使っている方</li>
<li>GitHub を使っている方</li>
<li>Vim を使っている、もしくは使いたい方</li>
</ul>
</section>
<section id="ターミナル以前" class="level2">
<h2 class="anchored" data-anchor-id="ターミナル以前">3. ターミナル以前</h2>
<section id="モニタ" class="level3">
<h3 class="anchored" data-anchor-id="モニタ">3.1. モニタ</h3>
<p>私は27インチ WQHD モニタを1枚使っていますが、やはりウルトラワイドモニタが良いらしいですね。</p>
<p>とはいえ私は出先や出社時はPC内蔵モニタを使っており、その場合も以降の内容で十分に Claude Code で並行作業はできるのでモニタが整っていない勢も安心して読み進めてください。</p>
</section>
<section id="os" class="level3">
<h3 class="anchored" data-anchor-id="os">3.2. OS</h3>
<p>最近よく使っているという理由で macOS (MacBook) を前提に話しますが、適宜読み替えても同様の環境が構築できるはずです。</p>
<p>一応 Ubuntu や Windows (WSL) も利用してはいるのである程度はクロスプラットフォームな内容にできていると思います。</p>
</section>
<section id="ウインドウマネージャー" class="level3">
<h3 class="anchored" data-anchor-id="ウインドウマネージャー">3.3. ウインドウマネージャー</h3>
<p>ターミナルと他ウインドウとの行き来を快適にできるのであればウインドウマネージャーは必須ではないです。</p>
<p>macOS では Windows でいう「Win+数字」に相当する一手で表示アプリを切り替えるショートカットが無いので AeroSpace を利用しています。</p>
<p><a href="https://github.com/nikitabobko/AeroSpace" class="uri">https://github.com/nikitabobko/AeroSpace</a></p>
<p>導入時に以下の記事がとても参考になりました。</p>
<p><a href="https://zenn.dev/mozumasu/articles/mozumasu-window-costomization">デスクトップは「清く・正しく・美しく」AeroSpace, JankyBorders, SketchyBar, alt-tab</a></p>
</section>
<section id="ブラウザ" class="level3">
<h3 class="anchored" data-anchor-id="ブラウザ">3.4. ブラウザ</h3>
<p>私は複数ウインドウや仮想デスクトップを使いこなすのが苦手なので Chrome のタブグループ機能で並行作業に対応することが多いです。</p>
</section>
<section id="dotfiles" class="level3">
<h3 class="anchored" data-anchor-id="dotfiles">3.5. dotfiles</h3>
<p>Claude Code による生産性をいかに上げるかが注目されている昨今、いつでもどんな PC でも快適に作業するために設定を記述しておく dotfiles の重要性が増していると個人的に話題です。</p>
<p>dotfiles にまだ入門できていない方は入門記事を参考にしてください。</p>
<p>今回述べている内容はほとんど以下の dotfiles に記述したものとなります。</p>
<p><a href="https://github.com/i9wa4/dotfiles" class="uri">https://github.com/i9wa4/dotfiles</a></p>
<p>私の設定で気になる内容がある場合は以下の DeepWiki で質問してみると的確な回答が得られます。</p>
<p><a href="https://deepwiki.com/i9wa4/dotfiles" class="uri">https://deepwiki.com/i9wa4/dotfiles</a></p>
</section>
</section>
<section id="シェル" class="level2">
<h2 class="anchored" data-anchor-id="シェル">4. シェル</h2>
<p>Zsh を愛用してます。</p>
<p>以下で Zsh のおすすめプラグインを紹介します。</p>
<section id="zinit" class="level3">
<h3 class="anchored" data-anchor-id="zinit">4.1. Zinit</h3>
<p>Zsh のプラグインマネージャーです。</p>
<p><a href="https://github.com/zdharma-continuum/zinit" class="uri">https://github.com/zdharma-continuum/zinit</a></p>
</section>
<section id="zeno.zsh-zshfish" class="level3">
<h3 class="anchored" data-anchor-id="zeno.zsh-zshfish">4.2. zeno.zsh (Zsh/Fish)</h3>
<p>Zsh の操作体験を全般的に向上させるプラグインの zeno.zsh です。</p>
<p><a href="https://github.com/yuki-yano/zeno.zsh" class="uri">https://github.com/yuki-yano/zeno.zsh</a></p>
<p>正直これが無いとターミナルを使う気になれないと思えるくらいに便利です。</p>
<p>最近 Fish にも対応したようなので Fish ユーザーの方もぜひ試してみてください。</p>
<p>作者の yuki-yano さんによる記事が参考になります。</p>
<p><a href="https://zenn.dev/yano/articles/zsh_plugin_from_deno">Deno + TypeScriptでzshプラグインを実装して最高になった</a></p>
<p>以下で Claude Code と共に生きる上で zeno.zsh に担ってもらっている役割を紹介します。</p>
<p>もちろんここに記述していない他の機能も便利です。</p>
<section id="ghq-管理リポジトリへの移動" class="level4">
<h4 class="anchored" data-anchor-id="ghq-管理リポジトリへの移動">4.2.1. ghq 管理リポジトリへの移動</h4>
<p>ghq については後述します。</p>
<p>zeno.zsh によって ghq + fzf の組み合わせでリポジトリへの移動がとても快適になります。</p>
</section>
<section id="tmux-セッション名へのリポジトリ名自動反映" class="level4">
<h4 class="anchored" data-anchor-id="tmux-セッション名へのリポジトリ名自動反映">4.2.2. tmux セッション名へのリポジトリ名自動反映</h4>
<p>ghq でリポジトリ移動すると tmux セッション名が自動でリポジトリ名に変更されます。</p>
<p>これにより難なく複数セッションを扱えます。</p>
</section>
</section>
</section>
<section id="ターミナル" class="level2">
<h2 class="anchored" data-anchor-id="ターミナル">5. ターミナル</h2>
<p>何でもよいのですが私は Alacritty を使っています。</p>
<p>通知音が鳴るように設定しておくとよいです。</p>
</section>
<section id="tmux" class="level2">
<h2 class="anchored" data-anchor-id="tmux">6. tmux</h2>
<p>複数ターミナルの管理について、タブ機能をもつターミナルもありますが私は tmux で複数ターミナルを管理するのが好きです。</p>
<p><a href="https://github.com/tmux/tmux/wiki/Installing" class="uri">https://github.com/tmux/tmux/wiki/Installing</a></p>
<section id="tmux-おすすめキーバインド" class="level3">
<h3 class="anchored" data-anchor-id="tmux-おすすめキーバインド">6.1. tmux おすすめキーバインド</h3>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tmux.conf</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="tmux.conf" style="background: #f1f3f5;"><pre class="sourceCode conf code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bind-key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-n</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">M-Left</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">previous-window</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bind-key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-n</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">M-Right</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">next-window</span></span>
<span id="cb1-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bind-key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-n</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">M-Up</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">switch-client</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-p</span></span>
<span id="cb1-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bind-key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-n</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">M-Down</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">switch-client</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-n</span></span></code></pre></div>
</div>
<p>こちらは</p>
<ul>
<li>tmux のセッション間を Alt + 上下キーで切り替える</li>
<li>tmux のウインドウ間を Alt + 左右キーで切り替える</li>
</ul>
<p>を実現するキーバインドです。</p>
<p>これにより Claude Code の並行作業の様子を片手でセッションやウインドウを切り替えながら確認できます。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tmux.conf</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="tmux.conf" style="background: #f1f3f5;"><pre class="sourceCode conf code-with-copy"><code class="sourceCode toml"><span id="cb2-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bind-key</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">%</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">split-window</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-h</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-c</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"#{pane_current_path}"</span></span>
<span id="cb2-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bind-key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">'"'</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">split-window</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-v</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-c</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"#{pane_current_path}"</span></span>
<span id="cb2-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bind-key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">c</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">new-window</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">-c</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"#{pane_current_path}"</span></span></code></pre></div>
</div>
<p>こちらは現在開いているディレクトリを継承して新しいペインやウインドウを作成するキーバインドです。</p>
<p>Claude Code と同じディレクトリに移動した状態のターミナルを即座に起動できます。</p>
</section>
<section id="tmux-おすすめプラグイン" class="level3">
<h3 class="anchored" data-anchor-id="tmux-おすすめプラグイン">6.2. tmux おすすめプラグイン</h3>
<p><a href="https://github.com/tmux-plugins/tpm" class="uri">https://github.com/tmux-plugins/tpm</a></p>
<p>tmux のプラグインマネージャーです。</p>
<p><a href="https://github.com/kristijanhusak/tmux-simple-git-status" class="uri">https://github.com/kristijanhusak/tmux-simple-git-status</a></p>
<p>tmux のステータスバーに Git の状態を表示するプラグインです。</p>
</section>
</section>
<section id="git" class="level2">
<h2 class="anchored" data-anchor-id="git">7. Git</h2>
<section id="worktree" class="level3">
<h3 class="anchored" data-anchor-id="worktree">7.1. worktree</h3>
<p>最近注目されている <code>git worktree</code> を使いましょう。</p>
<p>worktree 作成作業は定型化できると思うので worktree 作成用のスクリプトを作成しておくと便利です。</p>
</section>
<section id="gitignore" class="level3">
<h3 class="anchored" data-anchor-id="gitignore">7.2. gitignore</h3>
<p>リポジトリ内の作業ディレクトリ (<code>tmp/</code> など) を gitignore して Claude Code の作業場にしておくことをおすすめします。</p>
<p>指示用のドキュメントやログを格納して Claude Code に読ませるといった使い方ができます。</p>
</section>
<section id="ghq" class="level3">
<h3 class="anchored" data-anchor-id="ghq">7.3. ghq</h3>
<p>リポジトリの管理は ghq に任せたほうがよいです。</p>
<p><a href="https://github.com/x-motemen/ghq" class="uri">https://github.com/x-motemen/ghq</a></p>
</section>
</section>
<section id="エディタ" class="level2">
<h2 class="anchored" data-anchor-id="エディタ">8. エディタ</h2>
<p>私は Vim が好きで使っています。</p>
<p>以下で私が Claude Code のために利用している Vim プラグインを紹介します。</p>
<section id="vim-tmux-send-to-ai-cli" class="level3">
<h3 class="anchored" data-anchor-id="vim-tmux-send-to-ai-cli">8.1. vim-tmux-send-to-ai-cli</h3>
<p><a href="https://github.com/i9wa4/vim-tmux-send-to-ai-cli" class="uri">https://github.com/i9wa4/vim-tmux-send-to-ai-cli</a></p>
<p>拙作プラグインです。</p>
<p>Vim のバッファや複数行にわたる選択範囲などを自在に tmux の Claude Code ペインに送信できます。</p>
<p>現時点では Claude Code と Gemini CLI に対応しています。</p>
<p>このプラグインを使うと基本的に AI への入力にまつわる問題を Vim での文章作成における問題に帰着できます。</p>
<p>つまり何が言いたいかというと AI の入力欄の機能に依存せずに AI への入力を作成できるということです。</p>
<p>Vim に帰着させることで改行しづらい問題や Gemini CLI にカスタムスラッシュコマンドがない問題などを全て解決できます。</p>
</section>
<section id="ddc.vim" class="level3">
<h3 class="anchored" data-anchor-id="ddc.vim">8.2. ddc.vim</h3>
<p><a href="https://github.com/Shougo/ddc.vim" class="uri">https://github.com/Shougo/ddc.vim</a></p>
<p>補完機能を強化するために ddc.vim を使っています。</p>
</section>
<section id="skkeleton" class="level3">
<h3 class="anchored" data-anchor-id="skkeleton">8.3. skkeleton</h3>
<p><a href="https://github.com/vim-skk/skkeleton" class="uri">https://github.com/vim-skk/skkeleton</a></p>
<p>Vim で日本語入力をしづらいという問題を解決するために SKK を利用できる skkeleton を使っています。</p>
<p>私は ddc.vim の source として利用しています。</p>
</section>
<section id="ddc-source-file" class="level3">
<h3 class="anchored" data-anchor-id="ddc-source-file">8.4. ddc-source-file</h3>
<p><a href="https://github.com/LumaKernel/ddc-source-file" class="uri">https://github.com/LumaKernel/ddc-source-file</a></p>
<p>ddc.vim の source です。ファイル名やパスを補完してくれます。</p>
<p>一応 Vim の補完機能で</p>
<blockquote class="blockquote">
<p>CTRL-X CTRL-F</p>
</blockquote>
<p><a href="https://vim-jp.org/vimdoc-ja/usr_24.html#24.3" class="uri">https://vim-jp.org/vimdoc-ja/usr_24.html#24.3</a></p>
<p>を使用すると同等の補完ができますが、より快適な ddc.vim の補完機能がよいと思います。</p>
</section>
</section>
<section id="claude-code-設定" class="level2">
<h2 class="anchored" data-anchor-id="claude-code-設定">9. Claude Code 設定</h2>
<section id="claude_config_dir" class="level3">
<h3 class="anchored" data-anchor-id="claude_config_dir">9.1. <code>$CLAUDE_CONFIG_DIR</code></h3>
<p>必ず設定しましょう。</p>
<p>私は以下のように設定しています。</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">CLAUDE_CONFIG_DIR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${XDG_CONFIG_HOME}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>/claude</span></code></pre></div>
</section>
<section id="claude.md" class="level3">
<h3 class="anchored" data-anchor-id="claude.md">9.2. CLAUDE.md</h3>
<p>私は CLAUDE.md は作成していません。</p>
<p>CLAUDE.md を作成せず Claude Code に最適化しすぎないことで Gemini CLI などの他の AI ツールに移行しやすくしようと考えています。</p>
<p>もう1つの理由としては再読み込みが必要になる場面では CLAUDE.md よりカスタムスラッシュコマンドの再実行の方が楽だと感じているからです。</p>
</section>
<section id="カスタムスラッシュコマンド" class="level3">
<h3 class="anchored" data-anchor-id="カスタムスラッシュコマンド">9.3. カスタムスラッシュコマンド</h3>
<p>ここが AI とやりとりをする上での肝になります。</p>
<p>私の dotfiles では以下のカスタムスラッシュコマンドを用意しています。</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> commands</span>
<span id="cb4-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> commit.md</span>
<span id="cb4-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> CONTRIBUTING.md</span>
<span id="cb4-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> issue-to-pr.md</span>
<span id="cb4-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> learn-bigquery.md</span>
<span id="cb4-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> learn-databricks.md</span>
<span id="cb4-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> learn-dbt.md</span>
<span id="cb4-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> review.md</span></code></pre></div>
<p>issue-to-pr.md については、羃等性をもたせ Anthropic のベストプラクティスに沿った形で Pull Request 作成に誘導できるコマンドに仕上げている最中で、ノウハウが蓄積されてきたら別途記事にしようと思います。</p>
</section>
<section id="settings.json" class="level3">
<h3 class="anchored" data-anchor-id="settings.json">9.4. settings.json</h3>
<p>あまり凝ったことはしていません。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>settings.json</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="settings.json" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"permissions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-3">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"allow"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-4">        <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"deny"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-6">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bash(rm:*)"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-7">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WebFetch(domain:github.com)"</span></span>
<span id="cb5-8">        <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb5-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"env"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-11">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"BASH_DEFAULT_TIMEOUT_MS"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300000</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-12">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"BASH_MAX_TIMEOUT_MS"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300000</span></span>
<span id="cb5-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb5-14">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"includeCoAuthoredBy"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">false</span></span>
<span id="cb5-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>基本的に</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">claude</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dangerously-skip-permissions</span></span></code></pre></div>
<p>で起動するので permissions に関しては allow ではなく deny を充実させていく方針で設定しています。</p>
<p>Claude Code はよくファイル削除を試みるので <code>Bash(rm:*)</code> は必須だと思います。</p>
</section>
<section id="claude.json" class="level3">
<h3 class="anchored" data-anchor-id="claude.json">9.5. .claude.json</h3>
<p>通知音を鳴らすための設定を行います。</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">claude</span> config set <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> preferredNotifChannel terminal_bell</span></code></pre></div>
<p>このコマンドを実行すると以下のような設定が <code>.claude.json</code> に追加されます。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.claude.json</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename=".claude.json" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb8-1">  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"preferredNotifChannel":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"terminal_bell",</span></span></code></pre></div>
</div>
<p>これで足りなければ Hooks 設定の作り込みで対応していきましょう。</p>
<p>通知音設定については勉強中です。</p>
</section>
</section>
<section id="dev-container" class="level2">
<h2 class="anchored" data-anchor-id="dev-container">10. Dev Container</h2>
<p>Dev Container で Claude Code を利用することで安全に</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">claude</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dangerously-skip-permissions</span></span></code></pre></div>
<p>ができます。</p>
<p><a href="https://docs.anthropic.com/en/docs/claude-code/devcontainer" class="uri">https://docs.anthropic.com/en/docs/claude-code/devcontainer</a></p>
<p>Anthropic 公式が示す <code>.devcontainer</code> がそのまま使えます。</p>
<p>以下のようにグローバルな Claude Code 設定をマウントするなどして利便性向上を図りつつ使っていきましょう。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.devcontainer/devcontainer.json</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename=".devcontainer/devcontainer.json" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb10-1">    <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"mounts":</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-2">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=claude-code-bashhistory-${devcontainerId},target=/commandhistory,type=volume"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-3">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=claude-code-config-${devcontainerId},target=/home/node/.claude,type=volume"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source=${localEnv:HOME}/ghq/github.com/i9wa4/dotfiles/dot.config/claude,target=/home/node/.claude,type=bind,consistency=cached"</span></span>
<span id="cb10-5">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">,</span></span></code></pre></div>
</div>
<p><a href="https://github.com/devcontainers/cli" class="uri">https://github.com/devcontainers/cli</a></p>
<p>Dev Container を CLI で利用する際は Dev Container CLI を利用しましょう。</p>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">11. おわりに</h2>
<p>各項目それだけでも記事になるくらいの内容で消化が大変かもしれませんが参考になれば幸いです。</p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-ai</category>
  <category>tech-tmux</category>
  <category>tech-vim</category>
  <guid>https://i9wa4.github.io/blog/2025-07-14-optimize-your-teminal-for-claude-code.html</guid>
  <pubDate>Sun, 13 Jul 2025 17:27:26 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Vimへの初コントリビューションの経緯と学び</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-07-14-my-first-vim-contribution.html</link>
  <description><![CDATA[ 





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>この記事は <a href="https://vim-jp.org/ekiden/">Vim 駅伝</a> の 2025-07-14 の記事です。</p>
<p>前回は 2025-07-11 NI57721 さんの <a href="https://zenn.dev/vim_jp/articles/wayland-clipboard-feature-in-vim">Vim が Wayland のクリップボードをサポート</a> でした。</p>
</div>
</div>
<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>Vim 本体に出したバグ修正の Pull Request がマージされました。</p>
<p><a href="https://github.com/vim/vim/commit/b3eaae21b9f681d23466e7caa0b9d7e32cb4b206" class="uri">https://github.com/vim/vim/commit/b3eaae21b9f681d23466e7caa0b9d7e32cb4b206</a></p>
<p>以降でバグ発見の経緯と学びを共有します。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://i9wa4.github.io/assets/2025-07-14-my-first-vim-contribution/vim-contributor.png" class="img-fluid figure-img"></p>
<figcaption>私に Vim Contributor 表記が付与されている様子</figcaption>
</figure>
</div>
</section>
<section id="バグ発見の経緯" class="level2">
<h2 class="anchored" data-anchor-id="バグ発見の経緯">2. バグ発見の経緯</h2>
<p>私は Vim の HEAD (main ブランチの最新コミット) ビルドを日課にしています。</p>
<p>自分でビルドするとビルドオプションを指定できたり最新機能が使えたりして楽しいです。</p>
<p>そうしているうちにある日ビルトインのファイラープラグインである Netrw.vim のファイル一覧に空行の入るバグが入ったことに気付きました。</p>
<p>気になって Vim 本体の Issue や Pull Request を見ても同様のバグが報告されていなかったので自分で Pull Request を出すことにしました。</p>
<p>……反省点として後述しますがこの判断はちょっと考慮が足りなかったです。</p>
</section>
<section id="pull-request-作成まで" class="level2">
<h2 class="anchored" data-anchor-id="pull-request-作成まで">3. Pull Request 作成まで</h2>
<p>OSS プロジェクトに Pull Request を出したことがなかったのですが、 CONTRIBUTING.md を読めばいいであろうということは知っていたので Vim のリポジトリの CONTRIBUTING.md を読みました。</p>
<p><a href="https://github.com/vim/vim/blob/master/CONTRIBUTING.md" class="uri">https://github.com/vim/vim/blob/master/CONTRIBUTING.md</a></p>
<p>今回については Signing-off commits 推奨ということくらいで特に細かく何かを守る必要はないのかなという理解をしました。</p>
<p>とは言えそれでは不安があったので直近の Netrw.vim 関連のコミットや Pull Request をざっくり確認してみました。</p>
<p>実際の修正内容については Netrw.vim プラグインの直近1-2週間の間に入ったコミットの影響であろうことは分かっていたので Claude Code にバグ混入コミットを特定してもらって、修正案も出してもらいました。</p>
<p>自分のマシン (macOS) では1行追加するだけで修正できることが分かり、勢いで Pull Request を作成しました。</p>
</section>
<section id="pull-request-のレビュー" class="level2">
<h2 class="anchored" data-anchor-id="pull-request-のレビュー">4. Pull Request のレビュー</h2>
<p>Netrw.vim のメンテナの <span class="citation" data-cites="saccarosium">@saccarosium</span> さんにレビューしていただき Upstream と書き味を揃える Suggestion をいただきマージされました。</p>
</section>
<section id="学び" class="level2">
<h2 class="anchored" data-anchor-id="学び">5. 学び</h2>
<section id="反省点" class="level3">
<h3 class="anchored" data-anchor-id="反省点">5.1. 反省点</h3>
<p>Pull Request を出すまでは近眼的になって気付かなかったのですが今回の修正対象のファイルのトップに</p>
<p><a href="https://github.com/vim/vim/blob/68ee1cf7de36bdd6e642807c8beda751112aaab8/runtime/pack/dist/opt/netrw/autoload/netrw.vim">vim/runtime/pack/dist/opt/netrw/autoload/netrw.vim</a></p>
<blockquote class="blockquote">
<pre class="vim"><code>" Upstream: &lt;https://github.com/saccarosium/netrw.vim&gt;</code></pre>
</blockquote>
<p>と書かれている通り Netrw.vim には Upstream のリポジトリ</p>
<p><a href="https://github.com/saccarosium/netrw.vim" class="uri">https://github.com/saccarosium/netrw.vim</a></p>
<p>が存在します。</p>
<p>実際 Upstream では私が Pull Request を作成する2日前に既に本件は修正済みとなっていました。</p>
<p>というわけで本来はこの Upstream のリポジトリを最初に確認するのが正しい手順でした。</p>
<p>この状況を理解していた場合でも早めに Vim 本体側へ適用してほしい旨を相談することに変わりはなかったのですが、全てを知った上で行動するのが最善だったなあと思います。</p>
<p>だれがどのように関わって Vim という巨大なリポジトリが成り立っているのかもっと知ろうと思うようになりました。</p>
<p>もう1つの反省点は、改行回りが関係するので macOS だけでなく Windows についても考慮する必要があったという点です。</p>
<p>Vim のクロスプラットフォーム対応って大変なことなんだなあと改めて実感しました。</p>
</section>
<section id="netrw.vim-の理解度アップ" class="level3">
<h3 class="anchored" data-anchor-id="netrw.vim-の理解度アップ">5.2. Netrw.vim の理解度アップ</h3>
<p>Netrw.vim はメンテナ不在でバグも放置されていると言われていてここ数年その理解のままでした。</p>
<p>今回の Pull Request をきっかけに新しいメンテナの方が精力的にリファクタリングを行っている現状を知ることができました。</p>
<p>(今回のバグはリファクタリングの影響で発生したものでした)</p>
</section>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">6. おわりに</h2>
<p>理解が不十分なまま勢いで Pull Request を作成したもののメンテナの <span class="citation" data-cites="saccarosium">@saccarosium</span> さんの温情によりマージに至りました。</p>
<p>なんやかんやで自分は Netrw.vim を毎日使っていて愛着があるなと自覚したのでこれ以降 Upstream の最新版を利用してます。</p>
<p>また次のコントリビュートチャンスを狙っていきたいと思います。</p>
</section>
<section id="おまけ" class="level2">
<h2 class="anchored" data-anchor-id="おまけ">7. おまけ</h2>
<p><a href="https://vim-jp.org/docs/chat.html">vim-jp Slack</a> の #dev チャンネルにて成果報告した様子</p>
<p>vim-jp における #dev チャンネルとはもちろん Vim 本体開発の話題を扱うチャンネルですよ！</p>
<p><img src="https://i9wa4.github.io/assets/2025-07-14-my-first-vim-contribution/vim-jp-igyo.png" class="img-fluid" style="width:50.0%"></p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-vim</category>
  <category>vim-jp</category>
  <guid>https://i9wa4.github.io/blog/2025-07-14-my-first-vim-contribution.html</guid>
  <pubDate>Sun, 13 Jul 2025 15:06:04 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>tmux で Vim から Claude Code にテキストを送信するプラグインを作った</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-06-20-vim-plugin-for-tmux-claude-code.html</link>
  <description><![CDATA[ 





<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>昨日 Claude Code デビューしました！🙌</p>
<p>Claude Code 入力欄に Vim からテキストを送信したかったので Claude Code で Vim プラグインを作りました。</p>
</section>
<section id="プラグインの概要" class="level2">
<h2 class="anchored" data-anchor-id="プラグインの概要">2. プラグインの概要</h2>
<p>こちらが作成した Vim プラグインです。</p>
<p><a href="https://github.com/i9wa4/vim-tmux-send-to-claude-code"><img src="https://i9wa4.github.io/assets/2025-06-20-vim-plugin-for-tmux-claude-code/vim-tmux-send-to-claude-code.jpeg" class="img-fluid"></a></p>
<p><a href="https://github.com/i9wa4/vim-tmux-send-to-claude-code" class="uri">https://github.com/i9wa4/vim-tmux-send-to-claude-code</a></p>
<p>tmux で同一ウインドウ内の特定の Claude Code ペイン (変数で指定可) に対して Vim ペインから以下のテキストを送信できます。</p>
<ul>
<li>バッファ全体</li>
<li>ヤンクしたテキスト</li>
<li>Visual モードで選択したテキスト</li>
<li>指定した行範囲のテキスト</li>
</ul>
</section>
<section id="claude-code-を使ってみた感想" class="level2">
<h2 class="anchored" data-anchor-id="claude-code-を使ってみた感想">3. Claude Code を使ってみた感想</h2>
<p>もともとヤンクしたテキストを tmux のペイン間で送信するためのプラグインを作ろうと思っていました。</p>
<p>Claude Code に任せつつ私のアイデアを共有したところ、気の効いた機能追加やドキュメント整備をサクッとやってくれました。</p>
<p>README.md で紹介されているプラグインマネージャーが古かったり、キーバインドをデフォルトで押し付けてこようとしたりと既存のプラグインのリポジトリの特徴を掴んでいて面白いかったです。</p>
<p>キーバインド押し付けは主義に反するので直してもらいましたが、プラグインマネージャーは古いままにしておきましょうかね。笑</p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-ai</category>
  <category>tech-tmux</category>
  <category>tech-vim</category>
  <guid>https://i9wa4.github.io/blog/2025-06-20-vim-plugin-for-tmux-claude-code.html</guid>
  <pubDate>Thu, 19 Jun 2025 18:00:02 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>ローカル dbt で BigQuery への認証を行う</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-06-15-dbt-bigquery-auth.html</link>
  <description><![CDATA[ 





<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>dbt も BigQuery も経験それなりにあるものの dbt x BigQuery をやったことがなかったので認証方法を知ったのが今となります。</p>
</section>
<section id="dbt-のドキュメントを参照してみる" class="level2">
<h2 class="anchored" data-anchor-id="dbt-のドキュメントを参照してみる">2. dbt のドキュメントを参照してみる</h2>
<p>OAuth を使った認証方法は以下のドキュメントに記載されています。</p>
<p><a href="https://docs.getdbt.com/docs/core/connect-data-platform/bigquery-setup#local-oauth-gcloud-setup" class="uri">https://docs.getdbt.com/docs/core/connect-data-platform/bigquery-setup#local-oauth-gcloud-setup</a></p>
<p>ではあるのですが、実際のログイン方法として紹介されているコマンドは少し違うようで、代表的なものは以下のような感じです。</p>
<p><a href="https://dev.classmethod.jp/articles/dbt-core-bigquery/">dbt CoreでローカルからBigQueryを操作するためのセットアップ方法 | DevelopersIO</a></p>
<p>記事でよく見かけるものを実行していきます。</p>
</section>
<section id="認証手順" class="level2">
<h2 class="anchored" data-anchor-id="認証手順">3. 認証手順</h2>
<section id="profiles.yml-の設定" class="level3">
<h3 class="anchored" data-anchor-id="profiles.yml-の設定">3.1. profiles.yml の設定</h3>
<p>以下のような記載が含まれていれば OK</p>
<p><code>method: oauth</code> を指定していることがポイントです。</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>~/.dbt/profiles.yml</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="~/.dbt/profiles.yml" style="background: #f1f3f5;"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">my_dbt_project</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">target</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> dev</span></span>
<span id="cb1-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outputs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> bigquery</span></span>
<span id="cb1-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">method</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> oauth</span></span>
<span id="cb1-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">project</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> my-google-cloud-project</span></span>
<span id="cb1-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">threads</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb1-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">schema</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> my_schema</span></span></code></pre></div>
</div>
</section>
<section id="アプリケーション向けのログイン" class="level3">
<h3 class="anchored" data-anchor-id="アプリケーション向けのログイン">3.2. アプリケーション向けのログイン</h3>
<p>以下のコマンドにより dbt が Google Cloud の API を呼び出せることになります。</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> gcloud auth application-default login</span></code></pre></div>
</section>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">4. おわりに</h2>
<p>いま手元では1環境にしかログインしないのであまり深く理解していなくても大丈夫ですが、複数環境にログインする際にもうちょっと深く理解しておきます。</p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-data</category>
  <guid>https://i9wa4.github.io/blog/2025-06-15-dbt-bigquery-auth.html</guid>
  <pubDate>Sun, 15 Jun 2025 13:35:51 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>uv で Python のグローバルインストールを行う</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-06-10-install-global-python-with-uv.html</link>
  <description><![CDATA[ 





<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>Python 環境管理に uv を使い始めて以来 pyenv が不要になりアンインストールしたのですが、スポット的に Python のグローバルインストールが必要になったので uv での手順をメモしておきます。</p>
</section>
<section id="手順" class="level2">
<h2 class="anchored" data-anchor-id="手順">2. 手順</h2>
<p><a href="https://docs.astral.sh/uv/concepts/python-versions/#installing-python-executables">Python versions | uv</a></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> uv python install 3.12 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--default</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--preview</span></span></code></pre></div>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-python</category>
  <guid>https://i9wa4.github.io/blog/2025-06-10-install-global-python-with-uv.html</guid>
  <pubDate>Tue, 10 Jun 2025 05:37:57 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Poetry の pyproject.toml を使って uv で .venv を作成する</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-06-08-create-uv-venv-with-poetry-pyproject-toml.html</link>
  <description><![CDATA[ 





<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>最近 Python の仮想環境構築に uv を利用し始めて以来 pyenv を削除してしまったりとすっかり uv が気に入っています。</p>
<p>とはいえ全てのプロジェクトを直ちに uv へ移行するのも全員の学習コストがかかるため難しいと思います。</p>
<p>過渡期の対応としてローカルで Poetry の pyproject.toml を使用して uv で仮想環境構築する方法をメモしておきます。</p>
</section>
<section id="仮想環境構築手順" class="level2">
<h2 class="anchored" data-anchor-id="仮想環境構築手順">2. 仮想環境構築手順</h2>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .venv を作成する</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># このとき .python-version に記載された Python で構築される</span></span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> uv venv</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Using</span> CPython 3.12.1</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Creating</span> virtual environment at: .venv</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Activate</span> with: source .venv/bin/activate</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 仮想環境にパッケージをインストールする</span></span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> uv pip install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--requirement</span> pyproject.toml</span></code></pre></div>
</section>
<section id="おわりに" class="level2">
<h2 class="anchored" data-anchor-id="おわりに">3. おわりに</h2>
<p><code>$ uv pip install --requirement pyproject.toml</code> ここ爆速すぎて uv が好きになると思うのでちょっとやってみてほしいです。</p>
<p>ちなみにこの方法だと poetry.lock に従うわけではないので完全に同じ環境を再現するわけではありません。</p>
<p>とはいえほとんど齟齬のない環境を構築できます。</p>
<p>しばらくすると忘れそうなのでメモ代わりの記事でした。</p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-python</category>
  <guid>https://i9wa4.github.io/blog/2025-06-08-create-uv-venv-with-poetry-pyproject-toml.html</guid>
  <pubDate>Sat, 07 Jun 2025 15:58:37 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Vim/Neovim の保存時の LSP フォーマットを :w! のときに無効化する方法</title>
  <dc:creator>uma-chan </dc:creator>
  <link>https://i9wa4.github.io/blog/2025-06-04-use-cmdbang-to-disable-lsp-formatting-on-save.html</link>
  <description><![CDATA[ 





<section id="はじめに" class="level2">
<h2 class="anchored" data-anchor-id="はじめに">1. はじめに</h2>
<p>以下の記事を読んで Conform.nvim は使っていなかったものの悩みごとが解決する！！！！と思ったので自分の環境でも試してみました。</p>
<p><a href="https://blog.atusy.net/2025/06/03/skip-conform-nvim-format-on-save/">Conform.nvimの保存時フォーマットをスキップする方法 | Atusy’s blog</a></p>
</section>
<section id="vim-での設定" class="level2">
<h2 class="anchored" data-anchor-id="vim-での設定">2. Vim での設定</h2>
<p>dpp.vim で管理している TOML ファイルから vim-lsp-settings 向け設定を抜粋しました。</p>
<p>format on save 設定に <code>v:cmdbang</code> を使うことで、<code>:w!</code> のときはフォーマットをスキップするようにしています。</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[[plugins]]</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">repo</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">mattn/vim-lsp-settings</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb1-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">on_source</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">vim-lsp</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb1-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">hook_source</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'''</span></span>
<span id="cb1-5"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">let g:lsp_diagnostics_float_cursor = v:true</span></span>
<span id="cb1-6"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">let g:lsp_diagnostics_virtual_text_align = "after"</span></span>
<span id="cb1-7"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">let g:lsp_diagnostics_virtual_text_wrap = "truncate"</span></span>
<span id="cb1-8"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">let g:lsp_log_file = ''</span></span>
<span id="cb1-9"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">let g:lsp_settings_enable_suggestions = v:false</span></span>
<span id="cb1-10"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">let g:lsp_settings = {</span></span>
<span id="cb1-11"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\   'deno': {</span></span>
<span id="cb1-12"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\     'disabled': v:false,</span></span>
<span id="cb1-13"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\   },</span></span>
<span id="cb1-14"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\   'efm-langserver': {</span></span>
<span id="cb1-15"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\     'disabled': v:false,</span></span>
<span id="cb1-16"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\   },</span></span>
<span id="cb1-17"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\   'pylsp': {</span></span>
<span id="cb1-18"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\     'disabled': v:true,</span></span>
<span id="cb1-19"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\   },</span></span>
<span id="cb1-20"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\   'pylsp-all': {</span></span>
<span id="cb1-21"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\     'disabled': v:true,</span></span>
<span id="cb1-22"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\   },</span></span>
<span id="cb1-23"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">\ }</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">augroup MyLspSetting</span></span>
<span id="cb1-26"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">  autocmd!</span></span>
<span id="cb1-27"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">  autocmd BufWritePost * if !v:cmdbang | execute 'LspDocumentFormatSync' | endif</span></span>
<span id="cb1-28"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">augroup END</span></span>
<span id="cb1-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'''</span></span></code></pre></div>
</section>
<section id="neovim-での設定" class="level2">
<h2 class="anchored" data-anchor-id="neovim-での設定">3. Neovim での設定</h2>
<p>同様に TOML で管理している nvim-lspconfig 設定を抜粋しました。</p>
<p><code>vim.v.cmdbang</code> を使っています。</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[[plugins]]</span></span>
<span id="cb2-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">repo</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">neovim/nvim-lspconfig</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb2-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">on_event</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">VimEnter</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb2-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">lua_source</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'''</span></span>
<span id="cb2-5"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">-- https://github.com/uga-rosa/ddc-source-lsp-setup</span></span>
<span id="cb2-6"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">require('ddc_source_lsp_setup').setup()</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">-- https://github.com/neovim/nvim-lspconfig?tab=readme-ov-file#configuration</span></span>
<span id="cb2-9"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">local lspconfig = require('lspconfig')</span></span>
<span id="cb2-10"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">-- lspconfig.pylsp.setup{}</span></span>
<span id="cb2-11"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">lspconfig.denols.setup{}</span></span>
<span id="cb2-12"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">lspconfig.efm.setup{}</span></span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">-- :help lsp-defaults-disable</span></span>
<span id="cb2-15"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">vim.api.nvim_create_autocmd('LspAttach', {</span></span>
<span id="cb2-16"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">  callback = function(ev)</span></span>
<span id="cb2-17"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    -- unset</span></span>
<span id="cb2-18"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    vim.bo[ev.buf].formatexpr = nil</span></span>
<span id="cb2-19"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    vim.bo[ev.buf].omnifunc = nil</span></span>
<span id="cb2-20"></span>
<span id="cb2-21"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    -- unmap</span></span>
<span id="cb2-22"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    -- vim.keymap.del('n', 'K', { buffer = ev.buf })</span></span>
<span id="cb2-23"></span>
<span id="cb2-24"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    -- map</span></span>
<span id="cb2-25"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    local opts = { buffer = bufnr, noremap = true, silent = true }</span></span>
<span id="cb2-26"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    vim.keymap.set('n', '&lt;space&gt;lf', vim.diagnostic.open_float, opts)</span></span>
<span id="cb2-27"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">  end,</span></span>
<span id="cb2-28"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">})</span></span>
<span id="cb2-29"></span>
<span id="cb2-30"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">vim.api.nvim_create_autocmd('BufWritePost', {</span></span>
<span id="cb2-31"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">  callback = function()</span></span>
<span id="cb2-32"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    if vim.v.cmdbang == 0 then</span></span>
<span id="cb2-33"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">      vim.lsp.buf.format()</span></span>
<span id="cb2-34"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">    end</span></span>
<span id="cb2-35"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">  end,</span></span>
<span id="cb2-36"><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">})</span></span>
<span id="cb2-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'''</span></span></code></pre></div>
</section>
<section id="まとめ" class="level2">
<h2 class="anchored" data-anchor-id="まとめ">4. まとめ</h2>
<p>これまでは保存したいけどフォーマットしたくない場面を回避するためにフォーマット用のキーバインドを用意して format on save を無効化していました。</p>
<p>たまにフォーマットし忘れて辛かったのでこの対応でとってもハッピーになりました！</p>


</section>

 ]]></description>
  <category>blog</category>
  <category>tech</category>
  <category>tech-vim</category>
  <guid>https://i9wa4.github.io/blog/2025-06-04-use-cmdbang-to-disable-lsp-formatting-on-save.html</guid>
  <pubDate>Wed, 04 Jun 2025 14:24:39 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title></title>
  <dc:creator>馬渡 大樹</dc:creator>
  <link>https://i9wa4.github.io/slides/2025-06-03-self-introduction-1page.html</link>
  <description><![CDATA[ undefined ]]></description>
  <category>slides</category>
  <category>pivot</category>
  <guid>https://i9wa4.github.io/slides/2025-06-03-self-introduction-1page.html</guid>
  <pubDate>Mon, 02 Jun 2025 15:00:00 GMT</pubDate>
  <media:content url="https://i9wa4.github.io/assets/common/icon_hhkb3_large.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
